<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="python,django," />










<meta name="keywords" content="python,django">
<meta property="og:type" content="article">
<meta property="og:title" content="Django">
<meta property="og:url" content="http://yoursite.com/2018/01/30/Django/index.html">
<meta property="og:site_name" content="Mr.T&#39;blog">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/timgsss.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/django.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/test1.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/djangodbs.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/migrate.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/templates.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/templates.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/orm.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/books.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/heros.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/manager.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/clscreate.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/bookscreate.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/filter_exclude.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/orderby_values.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/select.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/area.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/views.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/viewstest.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/viewstest2.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/viewstest3.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/views404.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/gettest.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/jdfw.gif">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/redirect.gif">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/jsontest.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/session.gif">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/sessiontest.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/sessiondb.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/sessionbase64.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/sessionredis.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/templatestest.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/forTest.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/iftest.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/urltest.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/urltest1.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/urltest2.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/urltest3.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/htmltest.jpg">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/csrf1.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/csrf2.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/csrf3.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/verifycode.png">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/page.gif">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/city.gif">
<meta property="og:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/js.jpg">
<meta property="og:updated_time" content="2018-06-23T00:56:16.875Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Django">
<meta name="twitter:image" content="http://p3ek8hcdl.bkt.clouddn.com/image/timgsss.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/01/30/Django/"/>





  <title>Django | Mr.T'blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/zzb1999"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Mr.T'blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">大多数人终将平庸的度过一生！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/30/Django/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.T">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mr.T'blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Django</h1>
        

        <div class="post-meta">
          
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-30T14:41:56+08:00">
                2018-01-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  18,324 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  78 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/timgsss.jpg" alt=""><a id="more"></a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><hr>
<ul>
<li><p>MVC</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">大部分开发语言中都有MVC框架</span><br><span class="line">MVC框架的核心思想是：解耦</span><br><span class="line">降低各功能模块之间的耦合性，方便变更，更容易重构代码，最大程度上实现代码的重用</span><br><span class="line"></span><br><span class="line">m表示model，主要用于对数据库层的封装</span><br><span class="line">v表示view，用于向用户展示结果</span><br><span class="line">c表示controller，是核心，用于处理请求、获取数据、返回结果</span><br></pre></td></tr></table></figure>
</li>
<li><p>MVT</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Django是一款python的web开发框架</span><br><span class="line">与MVC有所不同，属于MVT框架 </span><br><span class="line">m表示model，负责与数据库交互 </span><br><span class="line">v表示view，是核心，负责接收请求、获取数据、返回结果 </span><br><span class="line">t表示template，负责呈现内容到浏览器</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p>ubuntu16.04</p>
<h4 id="python虚拟环境搭建"><a href="#python虚拟环境搭建" class="headerlink" title="python虚拟环境搭建"></a>python虚拟环境搭建</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">安装虚拟环境virtualenv</span><br><span class="line">sudo pip install virtualenv</span><br><span class="line"></span><br><span class="line">安装虚拟环境管理</span><br><span class="line">sudo easy_install virtualenvwrapper</span><br><span class="line"></span><br><span class="line">创建目录用来存放虚拟环境</span><br><span class="line">mkdir $HOME/.virtualenvs</span><br><span class="line"></span><br><span class="line">在~/.bashrc中添加行：</span><br><span class="line">    export WORKON_HOME=$HOME/.virtualenvs</span><br><span class="line">    source /usr/local/bin/virtualenvwrapper.sh</span><br><span class="line">    </span><br><span class="line">运行:</span><br><span class="line">    source ~/.bashrc</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv [虚拟环境名称]  创建python虚拟环境</span><br><span class="line">mkvirtualenv -p /usr/bin/python3(python安装目录，这里写的是ubuntu默认安装路径，) [虚拟环境名称]</span><br><span class="line">mkvirtualenv -p /usr/bin/python2 [虚拟环境名称]  </span><br><span class="line">-p 可以指定python2解释器还是python3解释器。</span><br><span class="line">workon [虚拟环境名称]   选择python虚拟环境</span><br><span class="line">deactivate         退出虚拟环境 </span><br><span class="line">rmvirtualenv [虚拟环境名称]   删除(慎用)</span><br></pre></td></tr></table></figure>
<p>查看虚拟环境中已经安装的包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip list</span><br><span class="line">pip freeze</span><br></pre></td></tr></table></figure></p>
<h4 id="安装django"><a href="#安装django" class="headerlink" title="安装django"></a>安装django</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">安装1.8.2版本，稳定性高、使用广、文档多的版本</span><br><span class="line">pip install django==1.8.2</span><br></pre></td></tr></table></figure>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/django.jpg" alt=""></p>
<h4 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject test1</span><br></pre></td></tr></table></figure>
<p>进入test1目录，目录结构如下图：<br><img src="http://p3ek8hcdl.bkt.clouddn.com/image/test1.png" alt=""></p>
<h4 id="目录说明"><a href="#目录说明" class="headerlink" title="目录说明"></a>目录说明</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">manage.py：一个命令行工具，可以使你用多种方式对Django项目进行交互</span><br><span class="line">_init _.py：一个空文件，它告诉Python这个目录应该被看做一个Python包</span><br><span class="line">settings.py：项目的配置</span><br><span class="line">urls.py：项目的URL声明</span><br><span class="line">wsgi.py：项目与WSGI兼容的Web服务器入口</span><br></pre></td></tr></table></figure>
<h3 id="设计模型"><a href="#设计模型" class="headerlink" title="设计模型"></a>设计模型</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本示例完成“图书-英雄”信息的维护，需要存储两种数据：图书、英雄</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">图书表结构设计：</span><br><span class="line">表名：BookInfo</span><br><span class="line">图书名称：btitle</span><br><span class="line">图书发布时间：bpub_date</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">英雄表结构设计：</span><br><span class="line">表名：HeroInfo</span><br><span class="line">英雄姓名：hname</span><br><span class="line">英雄性别：hgender</span><br><span class="line">英雄简介：hcontent</span><br><span class="line">所属图书：hbook</span><br><span class="line"></span><br><span class="line">图书-英雄的关系为一对多</span><br><span class="line">例： 天龙八部——虚竹</span><br><span class="line">     天龙八部——乔峰</span><br><span class="line">     天龙八部——王姑娘</span><br></pre></td></tr></table></figure>
<h4 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在settings.py文件中，通过DATABASES项进行数据库设置</span><br><span class="line">django支持的数据库包括：sqlite、mysql等主流数据库</span><br><span class="line">Django默认使用SQLite数据库</span><br></pre></td></tr></table></figure>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/djangodbs.jpg" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setting.py </span><br><span class="line">mysql  配置</span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    &apos;default&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos; : &apos;test1&apos; ,</span><br><span class="line">        &apos;USER&apos; : &apos;root&apos; ,</span><br><span class="line">        &apos;PASSWORD&apos; : &apos;mysql&apos; ,</span><br><span class="line">        &apos;HOST&apos; : &apos;127.0.0.1&apos; ,</span><br><span class="line">        &apos;PORT&apos; : &apos;3306&apos; ,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>python3中已经移除mysqldb，需先安装pymysql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql</span><br><span class="line">找到项目目录下的__init__.py 加入如下代码。</span><br><span class="line">import pymysql  </span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure></p>
<h4 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">在一个项目中可以创建一到多个应用，每个应用进行一种业务处理</span><br><span class="line">创建应用的命令：</span><br><span class="line">python manage.py startapp booktest</span><br><span class="line"></span><br><span class="line">├── booktest</span><br><span class="line">│   ├── admin.py</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── migrations</span><br><span class="line">│   │   └── __init__.py</span><br><span class="line">│   ├── models.py</span><br><span class="line">│   ├── tests.py</span><br><span class="line">│   └── views.py</span><br><span class="line">├── manage.py</span><br><span class="line">└── test1</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── __init__.pyc</span><br><span class="line">    ├── settings.py</span><br><span class="line">    ├── settings.pyc</span><br><span class="line">    ├── urls.py</span><br><span class="line">    └── wsgi.py</span><br></pre></td></tr></table></figure>
<h4 id="定义模型类"><a href="#定义模型类" class="headerlink" title="定义模型类"></a>定义模型类</h4><ul>
<li>有一个数据表，就有一个模型类与之对应</li>
<li>打开models.py文件，定义模型类</li>
<li>引入包from django.db import models</li>
<li>模型类继承自models.Model类</li>
<li>说明：不需要定义主键列，在生成时会自动添加，并且值为自动增长</li>
<li>当输出对象时，会调用对象的str方法<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    btitle = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    bpub_date = models.DateTimeField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"%d"</span> % self.pk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeroInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    hname = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    hgender = models.BooleanField()</span><br><span class="line">    hcontent = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    hbook = models.ForeignKey(<span class="string">'BookInfo'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"%d"</span> % self.pk</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="生成数据表"><a href="#生成数据表" class="headerlink" title="生成数据表"></a>生成数据表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">激活模型：编辑settings.py文件，将booktest应用加入到installed_apps中</span><br><span class="line">INSTALLED_APPS = (</span><br><span class="line">    &apos;django.contrib.admin&apos;,</span><br><span class="line">    &apos;django.contrib.auth&apos;,</span><br><span class="line">    &apos;django.contrib.contenttypes&apos;,</span><br><span class="line">    &apos;django.contrib.sessions&apos;,</span><br><span class="line">    &apos;django.contrib.messages&apos;,</span><br><span class="line">    &apos;django.contrib.staticfiles&apos;,</span><br><span class="line">    &apos;booktest&apos;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">生成迁移文件：根据模型类生成sql语句</span><br><span class="line">python manage.py makemigrations</span><br><span class="line">迁移文件被生成到应用的migrations目录</span><br></pre></td></tr></table></figure>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/migrate.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">执行迁移：执行sql语句生成数据表</span><br><span class="line">python manage.py migrate</span><br><span class="line"></span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+----------------------------+</span><br><span class="line">| Tables_in_test1            |</span><br><span class="line">+----------------------------+</span><br><span class="line">| auth_group                 |</span><br><span class="line">| auth_group_permissions     |</span><br><span class="line">| auth_permission            |</span><br><span class="line">| auth_user                  |</span><br><span class="line">| auth_user_groups           |</span><br><span class="line">| auth_user_user_permissions |</span><br><span class="line">| booktest_bookinfo          |</span><br><span class="line">| booktest_heroinfo          |</span><br><span class="line">| django_admin_log           |</span><br><span class="line">| django_content_type        |</span><br><span class="line">| django_migrations          |</span><br><span class="line">| django_session             |</span><br><span class="line">+----------------------------+</span><br></pre></td></tr></table></figure></p>
<h4 id="测试数据操作"><a href="#测试数据操作" class="headerlink" title="测试数据操作"></a>测试数据操作</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">进入python shell，进行简单的模型API练习</span><br><span class="line">python manage.py shell</span><br></pre></td></tr></table></figure>
<p>引入需要的包：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from booktest.models import BookInfo,HeroInfo</span><br><span class="line">from django.utils import timezone</span><br><span class="line">from datetime import *</span><br></pre></td></tr></table></figure></p>
<p>查询所有图书信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BookInfo.objects.all()</span><br></pre></td></tr></table></figure></p>
<p>新建图书信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b = BookInfo()</span><br><span class="line">b.btitle=&quot;射雕英雄传&quot;</span><br><span class="line">b.bpub_date=datetime(year=1990,month=1,day=10)</span><br><span class="line">b.save()</span><br></pre></td></tr></table></figure></p>
<p>查找图书信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b=BookInfo.objects.get(pk=1) # 获取主键为1的数据</span><br></pre></td></tr></table></figure></p>
<p>输出图书信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b</span><br><span class="line">b.id</span><br><span class="line">b.btitle</span><br></pre></td></tr></table></figure></p>
<p>修改图书信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b.btitle=&quot;天龙八部&quot;</span><br><span class="line">b.save()</span><br></pre></td></tr></table></figure></p>
<p>删除图书信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b.delete()</span><br></pre></td></tr></table></figure></p>
<h4 id="关联对象的操作"><a href="#关联对象的操作" class="headerlink" title="关联对象的操作"></a>关联对象的操作</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">对于HeroInfo可以按照上面的操作方式进行</span><br><span class="line">添加，注意添加关联对象</span><br><span class="line"></span><br><span class="line">h=HeroInfo()</span><br><span class="line">h.hname=&apos;虚竹&apos;</span><br><span class="line">h.hgender=True</span><br><span class="line">h.hcontent=&apos;天山六阳掌&apos;</span><br><span class="line">h.hbook=b</span><br><span class="line">h.save()</span><br><span class="line"></span><br><span class="line">获得关联集合：返回当前book对象的所有hero</span><br><span class="line">b.heroinfo_set.all()</span><br><span class="line"></span><br><span class="line">有一个HeroInfo存在，必须要有一个BookInfo对象，提供了创建关联的数据：</span><br><span class="line">h=b.heroinfo_set.create(hname=&apos;乔峰&apos;,hgender=False,hcontent=&apos;降龙十八掌&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="管理站点"><a href="#管理站点" class="headerlink" title="管理站点"></a>管理站点</h3><h4 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">运行如下命令可以开启服务器</span><br><span class="line">python manage.py runserver ip:port</span><br><span class="line">可以不写ip，默认端口为8000</span><br><span class="line"></span><br><span class="line">可以修改端口</span><br><span class="line">python manage.py runserver 8080</span><br><span class="line"></span><br><span class="line">这是一个纯python编写的轻量级web服务器，仅在开发阶段使用</span><br><span class="line">如果修改文件不需要重启服务器，如果增删文件需要重启服务器</span><br></pre></td></tr></table></figure>
<h4 id="管理操作"><a href="#管理操作" class="headerlink" title="管理操作"></a>管理操作</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">站点分为“内容发布”和“公共访问”两部分</span><br><span class="line">“内容发布”的部分负责添加、修改、删除内容，开发这些重复的功能是一件单调乏味、缺乏创造力的工作。</span><br><span class="line">为此，Django会根据定义的模型类完全自动地生成管理模块</span><br></pre></td></tr></table></figure>
<ul>
<li><p>使用django的管理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">创建一个管理员用户</span><br><span class="line">python manage.py createsuperuser</span><br><span class="line">按提示输入用户名、邮箱、密码</span><br><span class="line"></span><br><span class="line">启动服务器，通过“127.0.0.1:8000/admin”访问，输入上面创建的用户名、密码完成登录</span><br><span class="line">进入管理站点，默认可以对groups、users进行管理</span><br></pre></td></tr></table></figure>
</li>
<li><p>管理界面本地化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">编辑settings.py文件，设置编码、时区</span><br><span class="line">LANGUAGE_CODE = &apos;zh-Hans&apos;</span><br><span class="line">TIME_ZONE = &apos;Asia/Shanghai&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>向admin注册booktest的模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">打开booktest/admin.py文件，注册模型</span><br><span class="line">from django.contrib import admin</span><br><span class="line">from models import BookInfo</span><br><span class="line">admin.site.register(BookInfo)</span><br><span class="line"></span><br><span class="line">刷新管理页面，可以对BookInfo的数据进行增删改查操作</span><br><span class="line">问题：如果在str方法中返回中文，在修改和添加时会报ascii的错误</span><br><span class="line">解决：在str()方法中，将字符串末尾添加“.encode(&apos;utf-8&apos;)”</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义管理页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Django提供了admin.ModelAdmin类</span><br><span class="line">通过定义ModelAdmin的子类，来定义模型在Admin界面的显示方式</span><br><span class="line">class BookInfoAdmin(admin.ModelAdmin):</span><br><span class="line">    ...</span><br><span class="line">admin.site.register(Question, BookInfoAdmin)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>列表页属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">list_display：显示字段，可以点击列头进行排序</span><br><span class="line">list_display = [&apos;pk&apos;, &apos;btitle&apos;, &apos;bpub_date&apos;]</span><br><span class="line"></span><br><span class="line">list_filter：过滤字段，过滤框会出现在右侧</span><br><span class="line">list_filter = [&apos;btitle&apos;]</span><br><span class="line"></span><br><span class="line">search_fields：搜索字段，搜索框会出现在上侧</span><br><span class="line">search_fields = [&apos;btitle&apos;]</span><br><span class="line"></span><br><span class="line">list_per_page：分页，分页框会出现在下侧</span><br><span class="line">list_per_page = 10</span><br></pre></td></tr></table></figure></p>
<p>添加、修改页属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fields：属性的先后顺序</span><br><span class="line">fields = [&apos;bpub_date&apos;, &apos;btitle&apos;]</span><br><span class="line"></span><br><span class="line">fieldsets：属性分组</span><br><span class="line">fieldsets = [</span><br><span class="line">    (&apos;basic&apos;,&#123;&apos;fields&apos;: [&apos;btitle&apos;]&#125;),</span><br><span class="line">    (&apos;more&apos;, &#123;&apos;fields&apos;: [&apos;bpub_date&apos;]&#125;),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">fields和fieldsets不能一起用</span><br></pre></td></tr></table></figure></p>
<h4 id="关联对象"><a href="#关联对象" class="headerlink" title="关联对象"></a>关联对象</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">对于HeroInfo模型类，有两种注册方式</span><br><span class="line"></span><br><span class="line">方式一：与BookInfo模型类相同</span><br><span class="line">方式二：关联注册</span><br><span class="line">按照BookInfor的注册方式完成HeroInfo的注册</span><br><span class="line"></span><br><span class="line">接下来实现关联注册</span><br><span class="line">from django.contrib import admin</span><br><span class="line">from models import BookInfo,HeroInfo</span><br><span class="line"></span><br><span class="line">class HeroInfoInline(admin.StackedInline):</span><br><span class="line">    model = HeroInfo</span><br><span class="line">    extra = 2 # 默认提供两个HeroInfo的位置</span><br><span class="line"></span><br><span class="line">class BookInfoAdmin(admin.ModelAdmin):</span><br><span class="line">    inlines = [HeroInfoInline]</span><br><span class="line"></span><br><span class="line">admin.site.register(BookInfo, BookInfoAdmin)</span><br><span class="line"></span><br><span class="line">可以将内嵌的方式改为表格</span><br><span class="line">class HeroInfoInline(admin.TabularInline)</span><br></pre></td></tr></table></figure>
<h4 id="布尔值的显示"><a href="#布尔值的显示" class="headerlink" title="布尔值的显示"></a>布尔值的显示</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">发布性别的显示不是一个直观的结果，可以在HeroInfo模型类中定义方法进行封装</span><br><span class="line">def gender(self):</span><br><span class="line">    if self.hgender:</span><br><span class="line">        return &apos;男&apos;</span><br><span class="line">    else:</span><br><span class="line">        return &apos;女&apos;</span><br><span class="line">gender.short_description = &apos;性别&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在admin注册中使用gender代替hgender</span><br><span class="line"># admin.py</span><br><span class="line">class HeroInfoAdmin(admin.ModelAdmin):</span><br><span class="line">    list_display = [&apos;id&apos;, &apos;hname&apos;, &apos;gender&apos;, &apos;hcontent&apos;]</span><br></pre></td></tr></table></figure>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><ul>
<li>在django中，视图对WEB请求进行回应</li>
<li>视图接收reqeust对象作为第一个参数，包含了请求的信息</li>
<li>视图就是一个Python函数，被定义在views.py中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    return HttpResponse(&apos;hello world!&apos;)</span><br><span class="line">    </span><br><span class="line">def detail(request,id):</span><br><span class="line">    return HttpResponse(&quot;detail %s&quot; % id)</span><br><span class="line">    </span><br><span class="line">定义完成视图后，需要配置urlconf，否则无法处理请求</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="URLconf"><a href="#URLconf" class="headerlink" title="URLconf"></a>URLconf</h3><ul>
<li>在Django中，定义URLconf包括正则表达式、视图两部分</li>
<li>Django使用正则表达式匹配请求的URL，一旦匹配成功，则调用应用的视图</li>
<li>注意：只匹配路径部分，即除去域名、参数后的字符串<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在test1/urls.py包含booktest.urls，使主urlconf连接到booktest.urls模块</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^admin/&apos;, include(admin.site.urls)),</span><br><span class="line">    url(r&apos;^&apos;, include(&apos;booktest.urls&apos;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在booktest中创建的urls.py文件并添加urlconf</span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^$&apos;, views.index),</span><br><span class="line">    url(r&apos;^([0-9]+)/$&apos;, views.detail),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><ul>
<li>模板是html页面，可以根据视图中传递的数据填充值</li>
<li>创建模板的目录如下图：<br><img src="http://p3ek8hcdl.bkt.clouddn.com/image/templates.png" alt=""></li>
<li><p>修改settings.py文件，设置TEMPLATES的DIRS值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;DIRS&apos;: [os.path.join(BASE_DIR, &apos;templates&apos;)],</span><br></pre></td></tr></table></figure>
</li>
<li><p>在模板中访问视图传递的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;输出值，可以是变量，也可以是对象.属性&#125;&#125;</span><br><span class="line">&#123;%执行代码段%&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="定义index-html模板"><a href="#定义index-html模板" class="headerlink" title="定义index.html模板"></a>定义index.html模板</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;首页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;图书列表&lt;/h1&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&#123;%for book in booklist%&#125;</span><br><span class="line">&lt;li&gt;</span><br><span class="line">  &lt;a href=&quot;&#123;&#123;book.id&#125;&#125;&quot;&gt;</span><br><span class="line">    &#123;&#123;book.btitle&#125;&#125;</span><br><span class="line">  &lt;/a&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">&#123;%endfor%&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h4 id="定义detail-html模板"><a href="#定义detail-html模板" class="headerlink" title="定义detail.html模板"></a>定义detail.html模板</h4><p>在模板中访问对象成员时，都以属性的方式访问，即方法也不能加括号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;详细页&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;&#123;&#123;book.btitle&#125;&#125;&lt;/h1&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &#123;%for hero in book.heroinfo_set.all%&#125;</span><br><span class="line">  &lt;li&gt;&#123;&#123;hero.hname&#125;&#125;---&#123;&#123;hero.hcontent&#125;&#125;&lt;/li&gt;</span><br><span class="line">  &#123;%endfor%&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="使用模板"><a href="#使用模板" class="headerlink" title="使用模板"></a>使用模板</h3><p>编辑views.py文件，在方法中调用模板<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line">from django.template import RequestContext,loader</span><br><span class="line">from .models import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    booklist = BookInfo.objects.all()</span><br><span class="line">    template = loader.get_template(&apos;booktest/index.html&apos;)</span><br><span class="line">    context = RequestContext(request, &#123;&apos;booklist&apos;: booklist&#125;)</span><br><span class="line">    return HttpResponse(template.render(context))</span><br><span class="line"></span><br><span class="line">def detail(request, id):</span><br><span class="line">    book = BookInfo.objects.get(pk=id)</span><br><span class="line">    template = loader.get_template(&apos;booktest/detail.html&apos;)</span><br><span class="line">    context = RequestContext(request, &#123;&apos;book&apos;: book&#125;)</span><br><span class="line">    return HttpResponse(template.render(context))</span><br></pre></td></tr></table></figure></p>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/templates.jpg" alt=""></p>
<h3 id="去除模板的硬编码"><a href="#去除模板的硬编码" class="headerlink" title="去除模板的硬编码"></a>去除模板的硬编码</h3><ul>
<li><p>在index.html模板中，超链接是硬编码的，此时的请求地址为“127.0.0.1/1/”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;&#123;&#123;book.id&#125;&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>看如下情况：将urlconf中详细页改为如下，链接就找不到了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^book/([0-9]+)/$&apos;, views.detail),</span><br></pre></td></tr></table></figure>
</li>
<li><p>此时的请求地址应该为“127.0.0.1/book/1/”</p>
</li>
<li>问题总结：如果在模板中地址硬编码，将来urlconf修改后，地址将失效</li>
<li>解决：使用命名的url设置超链接</li>
<li><p>修改test1/urls.py文件，在include中设置namespace</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^admin/&apos;, include(admin.site.urls, namespace=&apos;booktest&apos;)),</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改booktest/urls.py文件，设置name</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^book/([0-9]+)/$&apos;, views.detail, name=&quot;detail&quot;),</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改index.html模板中的链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;&#123;%url &apos;booktest:detail&apos; book.id%&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>后面章节中会详细说 反向解析</p>
<h3 id="Render简写"><a href="#Render简写" class="headerlink" title="Render简写"></a>Render简写</h3><p>Django提供了函数Render()简化视图调用模板、构造上下文<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line">from .models import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    booklist = BookInfo.objects.all()</span><br><span class="line">    context = &#123;&apos;booklist&apos;: booklist&#125;</span><br><span class="line">    return render(request,&apos;booktest/index.html&apos;, context)</span><br><span class="line"></span><br><span class="line">def detail(request, id):</span><br><span class="line">    book = BookInfo.objects.get(pk=id)</span><br><span class="line">    context = &#123;&apos;book&apos;: book&#125;</span><br><span class="line">    return render(request, &apos;booktest/detail.html&apos;, context)</span><br></pre></td></tr></table></figure></p>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><h3 id="ORM简介"><a href="#ORM简介" class="headerlink" title="ORM简介"></a>ORM简介</h3><ul>
<li>MVC框架中包括一个重要的部分，就是ORM，它实现了数据模型与数据库的解耦，即数据模型的设计不需要依赖于特定的数据库，通过简单的配置就可以轻松更换数据库</li>
<li>ORM是“对象-关系-映射”的简称，主要任务是：<ul>
<li>根据对象的类型生成表结构</li>
<li>将对象、列表的操作，转换为sql语句</li>
<li>将sql查询到的结果转换为对象、列表</li>
</ul>
</li>
<li>这极大的减轻了开发人员的工作量，不需要面对因数据库变更而导致的无效劳动</li>
<li>Django中的模型包含存储数据的字段和约束，对应着数据库中唯一的表<br><img src="http://p3ek8hcdl.bkt.clouddn.com/image/orm.png" alt=""><h3 id="使用MySql数据库"><a href="#使用MySql数据库" class="headerlink" title="使用MySql数据库"></a>使用MySql数据库</h3></li>
<li><p>在虚拟环境中安装mysql包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mysql-python</span><br></pre></td></tr></table></figure>
</li>
<li><p>在mysql中创建数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create databases test1 charset=utf8</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开settings.py文件，修改DATABASES项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    &apos;default&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;test1&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;用户名&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;密码&apos;,</span><br><span class="line">        &apos;HOST&apos;: &apos;数据库服务器ip，本地可以使用localhost&apos;,</span><br><span class="line">        &apos;PORT&apos;: &apos;端口，默认为3306&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h3><ol>
<li>在models.py中定义模型类，要求继承自models.Model</li>
<li>把应用加入settings.py文件的installed_app项</li>
<li>生成迁移文件</li>
<li>执行迁移生成表</li>
<li>使用模型类进行crud操作</li>
</ol>
<h3 id="使用数据库生成模型类"><a href="#使用数据库生成模型类" class="headerlink" title="使用数据库生成模型类"></a>使用数据库生成模型类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py inspectdb &gt; booktest/models.py</span><br></pre></td></tr></table></figure>
<h3 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h3><h4 id="定义模型-1"><a href="#定义模型-1" class="headerlink" title="定义模型"></a>定义模型</h4><ul>
<li>在模型中定义属性，会生成表中的字段</li>
<li>django根据属性的类型确定以下信息：<ul>
<li>当前选择的数据库支持字段的类型</li>
<li>渲染管理表单时使用的默认html控件</li>
<li>在管理站点最低限度的验证</li>
</ul>
</li>
<li>django会为表增加自动增长的主键列，每个模型只能有一个主键列，如果使用选项设置某属性为主键列后，则django不会再生成默认的主键列。如果你想指定一个自定义主键字段，只要在某个字段上指定 primary_key=True 即可 例：id = models.AutoField(primary_key=True)</li>
<li>属性命名限制<ul>
<li>不能是python的保留关键字</li>
<li>由于django的查询方式，不允许使用连续的下划线<h4 id="定义属性"><a href="#定义属性" class="headerlink" title="定义属性"></a>定义属性</h4></li>
</ul>
</li>
<li>定义属性时，需要字段类型</li>
<li>字段类型被定义在django.db.models.fields目录下，为了方便使用，被导入到django.db.models中</li>
<li>使用方式<ol>
<li>导入from django.db import models</li>
<li>通过models.Field创建字段类型的对象，赋值给属性</li>
</ol>
</li>
<li>对于重要数据都做逻辑删除，不做物理删除，实现方法是定义isDelete属性，类型为BooleanField，默认值为False</li>
</ul>
<h4 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h4><ul>
<li>AutoField：一个根据实际ID自动增长的IntegerField，通常不指定<ul>
<li>如果不指定，一个主键字段将自动添加到模型中</li>
</ul>
</li>
<li>BooleanField：true/false 字段，此字段的默认表单控制是CheckboxInput</li>
<li>NullBooleanField：支持null、true、false三种值</li>
<li>CharField(max_length=字符长度)：字符串，默认的表单样式是 TextInput</li>
<li>TextField：大文本字段，一般超过4000使用，默认的表单控件是Textarea</li>
<li>IntegerField：整数</li>
<li>DecimalField(max_digits=None, decimal_places=None)：使用python的Decimal实例表示的十进制浮点数<ul>
<li>DecimalField.max_digits：位数总数</li>
<li>DecimalField.decimal_places：小数点后的数字位数</li>
</ul>
</li>
<li>FloatField：用Python的float实例来表示的浮点数</li>
<li>DateField[auto_now=False, auto_now_add=False])：使用Python的datetime.date实例表示的日期<ul>
<li>参数DateField.auto_now：每次保存对象时，自动设置该字段为当前时间，用于”最后一次修改”的时间戳，它总是使用当前日期，默认为false</li>
<li>参数DateField.auto_now_add：当对象第一次被创建时自动设置当前时间，用于创建的时间戳，它总是使用当前日期，默认为false</li>
<li>该字段默认对应的表单控件是一个TextInput. 在管理员站点添加了一个JavaScript写的日历控件，和一个“Today”的快捷按钮，包含了一个额外的invalid_date错误消息键</li>
<li>auto_now_add, auto_now, and default 这些设置是相互排斥的，他们之间的任何组合将会发生错误的结果</li>
</ul>
</li>
<li>TimeField：使用Python的datetime.time实例表示的时间，参数同DateField</li>
<li>DateTimeField：使用Python的datetime.datetime实例表示的日期和时间，参数同DateField</li>
<li>FileField：一个上传文件的字段</li>
<li>ImageField：继承了FileField的所有属性和方法，但对上传的对象进行校验，确保它是个有效的image</li>
</ul>
<h4 id="字段选项"><a href="#字段选项" class="headerlink" title="字段选项"></a>字段选项</h4><ul>
<li>通过字段选项，可以实现对字段的约束</li>
<li>在字段对象时通过关键字参数指定</li>
<li>null：如果为True，Django 将空值以NULL 存储到数据库中，默认值是 False</li>
<li>blank：如果为True，则该字段允许为空白，默认值是 False</li>
<li>对比：null是数据库范畴的概念，blank是表单验证范畴的</li>
<li>db_column：字段的名称，如果未指定，则使用属性的名称</li>
<li>db_index：若值为 True, 则在表中会为此字段创建索引</li>
<li>default：默认值</li>
<li>primary_key：若为 True, 则该字段会成为模型的主键字段</li>
<li>unique：如果为 True, 这个字段在表中必须有唯一值</li>
</ul>
<h4 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h4><ul>
<li>关系的类型包括<ul>
<li>ForeignKey：一对多，将字段定义在多的端中</li>
<li>ManyToManyField：多对多，将字段定义在两端中</li>
<li>OneToOneField：一对一，将字段定义在任意一端中</li>
</ul>
</li>
<li>可以维护递归的关联关系，使用’self’指定，详见“自关联”</li>
<li><p>用一访问多：对象.模型类小写_set</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bookinfo.heroinfo_set</span><br></pre></td></tr></table></figure>
</li>
<li><p>用一访问一：对象.模型类小写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroinfo.bookinfo</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问id：对象.属性_id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">heroinfo.book_id</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="元选项"><a href="#元选项" class="headerlink" title="元选项"></a>元选项</h4><ul>
<li>在模型类中定义类Meta，用于设置元信息</li>
<li><p>元信息db_table：定义数据表名称，推荐使用小写字母，数据表的默认名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;app_name&gt;_&lt;model_name&gt; # 应用名称_模型类名</span><br></pre></td></tr></table></figure>
</li>
<li><p>ordering：对象的默认排序字段，获取对象的列表时使用，接收属性构成的列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class BookInfo(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    class Meta():</span><br><span class="line">        ordering = [&apos;id&apos;]</span><br><span class="line">        </span><br><span class="line">字符串前加-表示倒序，不加-表示正序</span><br><span class="line">class BookInfo(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    class Meta():</span><br><span class="line">        ordering = [&apos;-id&apos;]</span><br><span class="line"></span><br><span class="line">排序会增加数据库的开销!!!</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="示例演示"><a href="#示例演示" class="headerlink" title="示例演示"></a>示例演示</h4><ul>
<li>创建test2项目，并创建booktest应用，使用mysql数据库</li>
<li><p>定义图书模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class BookInfo(models.Model):</span><br><span class="line">    btitle = models.CharField(max_length=20)</span><br><span class="line">    bpub_date = models.DateTimeField()</span><br><span class="line">    bread = models.IntegerField(default=0)</span><br><span class="line">    bcommet = models.IntegerField(default=0)</span><br><span class="line">    isDelete = models.BooleanField(default=False)</span><br></pre></td></tr></table></figure>
</li>
<li><p>英雄模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class HeroInfo(models.Model):</span><br><span class="line">    hname = models.CharField(max_length=20)</span><br><span class="line">    hgender = models.BooleanField(default=True)</span><br><span class="line">    hcontent = models.CharField(max_length=100)</span><br><span class="line">    isDelete = models.BooleanField(default=False)</span><br><span class="line">    hbook = models.ForeignKey(&apos;BookInfo&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义index、detail视图</p>
</li>
<li>index.html、detail.html模板</li>
<li>配置url，能够完成图书及英雄的展示</li>
</ul>
<h4 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h4><ul>
<li><p>模型BookInfo的测试数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insert into booktest_bookinfo(btitle,bpub_date,bread,bcommet,isDelete) values</span><br><span class="line">(&apos;射雕英雄传&apos;,&apos;1980-5-1&apos;,12,34,0),</span><br><span class="line">(&apos;天龙八部&apos;,&apos;1986-7-24&apos;,36,40,0),</span><br><span class="line">(&apos;笑傲江湖&apos;,&apos;1995-12-24&apos;,20,80,0),</span><br><span class="line">(&apos;雪山飞狐&apos;,&apos;1987-11-11&apos;,58,24,0);</span><br></pre></td></tr></table></figure>
</li>
<li><p>模型HeroInfo的测试数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">insert into booktest_heroinfo(hname,hgender,hbook_id,hcontent,isDelete) values</span><br><span class="line">(&apos;郭靖&apos;,1,1,&apos;降龙十八掌&apos;,0),</span><br><span class="line">(&apos;黄蓉&apos;,0,1,&apos;打狗棍法&apos;,0),</span><br><span class="line">(&apos;黄药师&apos;,1,1,&apos;弹指神通&apos;,0),</span><br><span class="line">(&apos;欧阳锋&apos;,1,1,&apos;蛤蟆功&apos;,0),</span><br><span class="line">(&apos;梅超风&apos;,0,1,&apos;九阴白骨爪&apos;,0),</span><br><span class="line">(&apos;乔峰&apos;,1,2,&apos;降龙十八掌&apos;,0),</span><br><span class="line">(&apos;段誉&apos;,1,2,&apos;六脉神剑&apos;,0),</span><br><span class="line">(&apos;虚竹&apos;,1,2,&apos;天山六阳掌&apos;,0),</span><br><span class="line">(&apos;王语嫣&apos;,0,2,&apos;神仙姐姐&apos;,0),</span><br><span class="line">(&apos;令狐冲&apos;,1,3,&apos;独孤九剑&apos;,0),</span><br><span class="line">(&apos;任盈盈&apos;,0,3,&apos;弹琴&apos;,0),</span><br><span class="line">(&apos;岳不群&apos;,1,3,&apos;华山剑法&apos;,0),</span><br><span class="line">(&apos;东方不败&apos;,0,3,&apos;葵花宝典&apos;,0),</span><br><span class="line">(&apos;胡斐&apos;,1,4,&apos;胡家刀法&apos;,0),</span><br><span class="line">(&apos;苗若兰&apos;,0,4,&apos;黄衣&apos;,0),</span><br><span class="line">(&apos;程灵素&apos;,0,4,&apos;医术&apos;,0),</span><br><span class="line">(&apos;袁紫衣&apos;,0,4,&apos;六合拳&apos;,0);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/books.jpg" alt=""></p>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/heros.jpg" alt=""></p>
<h3 id="模型成员"><a href="#模型成员" class="headerlink" title="模型成员"></a>模型成员</h3><h4 id="类的属性"><a href="#类的属性" class="headerlink" title="类的属性"></a>类的属性</h4><ul>
<li>objects：是Manager类型的对象，用于与数据库进行交互</li>
<li>当定义模型类时没有指定管理器，则Django会为模型类提供一个名为objects的管理器</li>
<li><p>支持明确指定模型类的管理器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class BookInfo(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    books = models.Manager()</span><br></pre></td></tr></table></figure>
</li>
<li><p>当为模型类指定管理器后，django不再为模型类生成名为objects的默认管理器</p>
</li>
</ul>
<h4 id="管理器Manager"><a href="#管理器Manager" class="headerlink" title="管理器Manager"></a>管理器Manager</h4><ul>
<li>管理器是Django的模型进行数据库的查询操作的接口，Django应用的每个模型都拥有至少一个管理器</li>
<li>自定义管理器类主要用于两种情况</li>
<li>情况一：向管理器类中添加额外的方法：见下面“创建对象”中的方式二</li>
<li>情况二：修改管理器返回的原始查询集：重写get_queryset()方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoManager(models.Manager):</span><br><span class="line">    def get_queryset(self):</span><br><span class="line">        return super(BookInfoManager, self).get_queryset().filter(isDelete=False)</span><br><span class="line">class BookInfo(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    books = BookInfoManager()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/manager.jpg" alt=""></p>
<h4 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h4><ul>
<li>当创建对象时，django不会对数据库进行读写操作</li>
<li>调用save()方法才与数据库交互，将对象保存到数据库中</li>
<li>使用关键字参数构造模型对象很麻烦，推荐使用下面的两种之式</li>
<li>说明： <em>init </em>方法已经在基类models.Model中使用，在自定义模型中无法使用</li>
<li>方式一：在模型类中增加一个类方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class BookInfo(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    @classmethod</span><br><span class="line">    def create(cls, title, pub_date):</span><br><span class="line">        book = cls(btitle=title, bpub_date=pub_date)</span><br><span class="line">        book.bread=0</span><br><span class="line">        book.bcommet=0</span><br><span class="line">        book.isDelete = False</span><br><span class="line">        return book</span><br><span class="line">        </span><br><span class="line">调用：book=BookInfo.create(&quot;hello&quot;,datetime(1980,10,11));</span><br><span class="line">保存：book.save()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/clscreate.jpg" alt=""></p>
<ul>
<li>方式二：在自定义管理器中添加一个方法</li>
<li>在管理器的方法中，可以通过self.model来得到它所属的模型类<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoManager(models.Manager):</span><br><span class="line">    def create_book(self, title, pub_date):</span><br><span class="line">        book = self.model()</span><br><span class="line">        book.btitle = title</span><br><span class="line">        book.bpub_date = pub_date</span><br><span class="line">        book.bread=0</span><br><span class="line">        book.bcommet=0</span><br><span class="line">        book.isDelete = False</span><br><span class="line">        return book</span><br><span class="line"></span><br><span class="line">class BookInfo(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    books = BookInfoManager()</span><br><span class="line">调用：book=BookInfo.books.create_book(&quot;abc&quot;,datetime(1980,1,1))</span><br><span class="line">保存：book.save()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/bookscreate.jpg" alt=""></p>
<h4 id="实例的属性"><a href="#实例的属性" class="headerlink" title="实例的属性"></a>实例的属性</h4><ul>
<li>DoesNotExist：在进行单个查询时，模型的对象不存在时会引发此异常，结合try/except使用</li>
</ul>
<h4 id="实例的方法"><a href="#实例的方法" class="headerlink" title="实例的方法"></a>实例的方法</h4><ul>
<li>save()：将模型对象保存到数据表中</li>
<li>delete()：将模型对象从数据表中删除(物理删除)</li>
</ul>
<h3 id="模型查询"><a href="#模型查询" class="headerlink" title="模型查询"></a>模型查询</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><ul>
<li>查询集表示从数据库中获取的对象集合</li>
<li>查询集可以含有零个、一个或多个过滤器</li>
<li>过滤器基于所给的参数限制查询的结果</li>
<li>从Sql的角度，查询集和select语句等价，过滤器像where和limit子句</li>
<li>接下来主要讨论如下知识点<ul>
<li>查询集</li>
<li>字段查询：比较运算符，F对象，Q对象</li>
</ul>
</li>
</ul>
<h4 id="查询集"><a href="#查询集" class="headerlink" title="查询集"></a>查询集</h4><ul>
<li>在管理器上调用过滤器方法会返回查询集</li>
<li>查询集经过过滤器筛选后返回新的查询集，因此可以写成链式过滤</li>
<li>惰性执行：创建查询集不会带来任何数据库的访问，直到调用数据时，才会访问数据库</li>
<li>何时对查询集求值：迭代，序列化，与if合用</li>
<li>返回查询集的方法，称为过滤器<ul>
<li>all()</li>
<li>filter()返回一个新的QuerySet，包含与给定的查询参数匹配的对象。</li>
<li>exclude()返回一个新的QuerySet，它包含不满足给定的查找参数的对象。</li>
<li>order_by()排序</li>
<li>values()：一个对象构成一个字典，然后构成一个列表返回</li>
</ul>
</li>
<li>写法：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filter(键1=值1,键2=值2)</span><br><span class="line">等价于</span><br><span class="line">filter(键1=值1).filter(键2=值2)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/filter_exclude.jpg" alt=""></p>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/orderby_values.jpg" alt=""></p>
<ul>
<li>返回单个值的方法<ul>
<li>get()：返回单个满足条件的对象<ul>
<li>如果未找到会引发”模型类.DoesNotExist”异常</li>
<li>如果多条被返回，会引发”模型类.MultipleObjectsReturned”异常</li>
</ul>
</li>
<li>count()：返回当前查询的总条数</li>
<li>first()：返回第一个对象</li>
<li>last()：返回最后一个对象</li>
<li>exists()：判断查询集中是否有数据，如果有则返回True</li>
</ul>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/select.jpg" alt=""></p>
<h4 id="限制查询集"><a href="#限制查询集" class="headerlink" title="限制查询集"></a>限制查询集</h4><ul>
<li>查询集返回列表，可以使用下标的方式进行限制，等同于sql中的limit和offset子句</li>
<li>注意：不支持负数索引</li>
<li>使用下标后返回一个新的查询集，不会立即执行查询</li>
<li>如果获取一个对象，直接使用[0]，等同于[0:1].get()，但是如果没有数据，[0]引发IndexError异常，[0:1].get()引发DoesNotExist异常</li>
</ul>
<h4 id="查询集的缓存"><a href="#查询集的缓存" class="headerlink" title="查询集的缓存"></a>查询集的缓存</h4><ul>
<li>每个查询集都包含一个缓存来最小化对数据库的访问</li>
<li>在新建的查询集中，缓存为空，首次对查询集求值时，会发生数据库查询，django会将查询的结果存在查询集的缓存中，并返回请求的结果，接下来对查询集求值将重用缓存的结果</li>
<li><p>情况一：这构成了两个查询集，无法重用缓存，每次查询都会与数据库进行一次交互，增加了数据库的负载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print([e.title for e in Entry.objects.all()])</span><br><span class="line">print([e.title for e in Entry.objects.all()])</span><br></pre></td></tr></table></figure>
</li>
<li><p>情况二：两次循环使用同一个查询集，第二次使用缓存中的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">querylist=Entry.objects.all()</span><br><span class="line">print([e.title for e in querylist])</span><br><span class="line">print([e.title for e in querylist])</span><br></pre></td></tr></table></figure>
</li>
<li><p>何时查询集不会被缓存：当只对查询集的部分进行求值时会检查缓存，但是如果这部分不在缓存中，那么接下来查询返回的记录将不会被缓存，这意味着使用索引来限制查询集将不会填充缓存，如果这部分数据已经被缓存，则直接使用缓存中的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">例如，重复获取查询集对象中一个特定的索引将每次都查询数据库：</span><br><span class="line">&gt;&gt;&gt; queryset = Entry.objects.all()</span><br><span class="line">&gt;&gt;&gt; print queryset[5] # Queries the database</span><br><span class="line">&gt;&gt;&gt; print queryset[5] # Queries the database again</span><br><span class="line"></span><br><span class="line">然而，如果已经对全部查询集求值过，则将检查缓存：</span><br><span class="line">&gt;&gt;&gt; queryset = Entry.objects.all()</span><br><span class="line">&gt;&gt;&gt; [entry for entry in queryset] # Queries the database</span><br><span class="line">&gt;&gt;&gt; print queryset[5] # Uses cache</span><br><span class="line">&gt;&gt;&gt; print queryset[5] # Uses cache</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="字段查询"><a href="#字段查询" class="headerlink" title="字段查询"></a>字段查询</h4><ul>
<li>实现where子名，作为方法filter()、exclude()、get()的参数</li>
<li>语法：属性名称__比较运算符=值</li>
<li>表示两个下划线，左侧是属性名称，右侧是比较类型</li>
<li>对于外键，使用“属性名_id”表示外键的原始值</li>
<li>转义：like语句中使用了%与，匹配数据中的%与，在过滤器中直接写，例如：filter(title__contains=”%”)=&gt;where title like ‘%\%%’，表示查找标题中包含%的</li>
</ul>
<h4 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h4><ul>
<li><p>exact：表示判等，大小写敏感；如果没有写“ 比较运算符”，表示判等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(isDelete=False)</span><br></pre></td></tr></table></figure>
</li>
<li><p>contains：是否包含，大小写敏感</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exclude(btitle__contains=&apos;传&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>startswith、endswith：以value开头或结尾，大小写敏感</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exclude(btitle__endswith=&apos;传&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>isnull、isnotnull：是否为null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(btitle__isnull=False)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在前面加个i表示不区分大小写，如iexact、icontains、istarswith、iendswith</p>
</li>
<li><p>in：是否包含在范围内</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(pk__in=[1, 2, 3, 4, 5])</span><br></pre></td></tr></table></figure>
</li>
<li><p>gt、gte、lt、lte：大于、大于等于、小于、小于等于</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(id__gt=3)</span><br></pre></td></tr></table></figure>
</li>
<li><p>year、month、day、week_day、hour、minute、second：对日期间类型的属性进行运算</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filter(bpub_date__year=1980)</span><br><span class="line">filter(bpub_date__gt=date(1980, 12, 31))</span><br></pre></td></tr></table></figure>
</li>
<li><p>跨关联关系的查询：处理join查询</p>
<ul>
<li>语法：模型类名 &lt;属性名&gt; &lt;比较&gt;</li>
<li>注：可以没有__&lt;比较&gt;部分，表示等于，结果同inner join</li>
<li>可返向使用，即在关联的两个模型中都可以使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(heroinfo__hcontent__contains=&apos;八&apos;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>查询的快捷方式：pk，pk表示primary key，默认的主键是id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(pk__lt=6)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h4><ul>
<li>使用aggregate()函数返回聚合函数的值</li>
<li><p>函数：Avg，Count，Max，Min，Sum</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from django.db.models import Max</span><br><span class="line">maxDate = list.aggregate(Max(&apos;bpub_date&apos;))</span><br></pre></td></tr></table></figure>
</li>
<li><p>count的一般用法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count = BookInfo.objects.count()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="F对象"><a href="#F对象" class="headerlink" title="F对象"></a>F对象</h4><ul>
<li><p>可以使用模型的字段A与字段B进行比较，如果A写在了等号的左边，则B出现在等号的右边，需要通过F对象构造</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.filter(bread__gte=F(&apos;bcommet&apos;))</span><br></pre></td></tr></table></figure>
</li>
<li><p>django支持对F()对象使用算数运算</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.filter(bread__gte=F(&apos;bcommet&apos;) * 2)</span><br></pre></td></tr></table></figure>
</li>
<li><p>F()对象中还可以写作“模型类__列名”进行关联查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.filter(isDelete=F(&apos;heroinfo__isDelete&apos;))</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于date/time字段，可与timedelta()进行运算</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.filter(bpub_date__lt=F(&apos;bpub_date&apos;) + timedelta(days=1))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Q对象"><a href="#Q对象" class="headerlink" title="Q对象"></a>Q对象</h4><ul>
<li>过滤器的方法中关键字参数查询，会合并为And进行</li>
<li>需要进行or查询，使用Q()对象</li>
<li><p>Q对象(django.db.models.Q)用于封装一组关键字参数，这些关键字参数与“比较运算符”中的相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from django.db.models import Q</span><br><span class="line">list.filter(Q(pk__lt=6))</span><br></pre></td></tr></table></figure>
</li>
<li><p>Q对象可以使用&amp;（and）、|（or）操作符组合起来</p>
</li>
<li><p>当操作符应用在两个Q对象时，会产生一个新的Q对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list.filter(pk__lt=6).filter(bcommet__gt=10)</span><br><span class="line">list.filter(Q(pk__lt=6) | Q(bcommet__gt=10)) # 主键小于6或者评论大于10的</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用~（not）操作符在Q对象前表示取反</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.filter(~Q(pk__lt=6)) # 主键不小于6的，即 大于等于6</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以使用&amp;|~结合括号进行分组，构造做生意复杂的Q对象</p>
</li>
<li>过滤器函数可以传递一个或多个Q对象作为位置参数，如果有多个Q对象，这些参数的逻辑为and</li>
<li>过滤器函数可以混合使用Q对象和关键字参数，所有参数都将and在一起，Q对象必须位于关键字参数的前面</li>
</ul>
<h3 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h3><ul>
<li>对于地区信息，属于一对多关系，使用一张表，存储所有的信息</li>
<li>类似的表结构还应用于分类信息，可以实现无限级分类</li>
<li><p>新建模型AreaInfo，生成迁移</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class AreaInfo(models.Model):</span><br><span class="line">    atitle = models.CharField(max_length=20)</span><br><span class="line">    aParent = models.ForeignKey(&apos;self&apos;, null=True, blank=True)</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问关联对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">上级对象：area.aParent</span><br><span class="line">下级对象：area.areainfo_set.all()</span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="http://p3ek8hcdl.bkt.clouddn.com/txt/area.txt" target="_blank" rel="noopener">加入测试数据</a></p>
</li>
<li><p>在booktest/views.py中定义视图area</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from models import AreaInfo</span><br><span class="line">def area(request):</span><br><span class="line">    area = AreaInfo.objects.get(pk=130100)</span><br><span class="line">    return render(request, &apos;booktest/area.html&apos;, &#123;&apos;area&apos;: area&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义模板area.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;地区&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">当前地区：&#123;&#123;area.atitle&#125;&#125;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">上级地区：&#123;&#123;area.aParent.atitle&#125;&#125;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">下级地区：</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123; %for a in area.areainfo_set.all%&#125;</span><br><span class="line">    &lt;li&gt;&#123;&#123;a.atitle&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123; %endfor%&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在booktest/urls.py中配置一个新的urlconf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^area/$&apos;, views.area, name=&apos;area&apos;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/area.jpg" alt=""></p>
<h2 id="视图-1"><a href="#视图-1" class="headerlink" title="视图"></a>视图</h2><ul>
<li>视图接受Web请求并且返回Web响应</li>
<li>视图就是一个python函数，被定义在views.py中</li>
<li>响应可以是一张网页的HTML内容，一个重定向，一个404错误等等</li>
<li>响应处理过程如下图：</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/views.jpg" alt=""></p>
<h3 id="URLconf-1"><a href="#URLconf-1" class="headerlink" title="URLconf"></a>URLconf</h3><ul>
<li>在settings.py文件中通过ROOT_URLCONF指定根级url的配置</li>
<li>urlpatterns是一个url()实例的列表</li>
<li>一个url()对象包括：<ul>
<li>正则表达式</li>
<li>视图函数</li>
<li>名称name</li>
</ul>
</li>
<li>编写URLconf的注意：<ul>
<li>若要从url中捕获一个值，需要在它周围设置一对圆括号</li>
<li>不需要添加一个前导的反斜杠，如应该写作’test/‘，而不应该写作’/test/‘</li>
<li>每个正则表达式前面的r表示字符串不转义</li>
</ul>
</li>
<li><p>请求的url被看做是一个普通的python字符串，进行匹配时不包括get或post请求的参数及域名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.ixysec.com/python/django/?i=1&amp;p=new，只匹配“python/django/”部分</span><br></pre></td></tr></table></figure>
</li>
<li><p>正则表达式非命名组，通过位置参数传递给视图<br><img src="http://p3ek8hcdl.bkt.clouddn.com/image/viewstest.jpg" alt=""></p>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/viewstest2.jpg" alt=""></p>
<ul>
<li>正则表达式命名组，通过关键字参数传递给视图，本例中关键字参数为id<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^(?P&lt;id1&gt;\d+)/(?P&lt;id3&gt;\d+)/(?P&lt;id2&gt;\d+)/$&apos;, views.test),</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/viewstest3.jpg" alt=""></p>
<ul>
<li>参数匹配规则：优先使用命名参数，如果没有命名参数则使用位置参数</li>
<li>每个捕获的参数都作为一个普通的python字符串传递给视图</li>
<li>性能：urlpatterns中的每个正则表达式在第一次访问它们时被编译，这使得系统相当快</li>
</ul>
<h4 id="包含其它的URLconfs"><a href="#包含其它的URLconfs" class="headerlink" title="包含其它的URLconfs"></a>包含其它的URLconfs</h4><ul>
<li><p>在应用中创建urls.py文件，定义本应用中的urlconf，再在项目的settings中使用include()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from django.conf.urls import include, url</span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^&apos;, include(&apos;booktest.urls&apos;, namespace=&apos;booktest&apos;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>匹配过程：先与主URLconf匹配，成功后再用剩余的部分与应用中的URLconf匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">请求http://www.ixysec.com/booktest/1/</span><br><span class="line">在sesstings.py中的配置：</span><br><span class="line">url(r&apos;^booktest/&apos;, include(&apos;booktest.urls&apos;, namespace=&apos;booktest&apos;)),</span><br><span class="line">在booktest应用urls.py中的配置</span><br><span class="line">url(r&apos;^(\d+)/$&apos;, views.detail, name=&apos;detail&apos;),</span><br><span class="line">匹配部分是：/booktest/1/</span><br><span class="line">匹配过程：在settings.py中与“booktest/”成功，再用“1/”与booktest应用的urls匹配</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用include可以去除urlconf的冗余</p>
</li>
<li>参数：视图会收到来自父URLconf、当前URLconf捕获的所有参数</li>
<li>在include中通过namespace定义命名空间，用于反解析</li>
</ul>
<h4 id="URL的反向解析"><a href="#URL的反向解析" class="headerlink" title="URL的反向解析"></a>URL的反向解析</h4><ul>
<li>如果在视图、模板中使用硬编码的链接，在urlconf发生改变时，维护是一件非常麻烦的事情</li>
<li>解决：在做链接时，通过指向urlconf的名称，动态生成链接地址</li>
<li>视图：使用django.core.urlresolvers.reverse()函数</li>
<li>模板：使用url模板标签<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;&#123;%url &apos;namespace:name&apos;%&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="视图函数"><a href="#视图函数" class="headerlink" title="视图函数"></a>视图函数</h3><h4 id="定义视图"><a href="#定义视图" class="headerlink" title="定义视图"></a>定义视图</h4><ul>
<li>本质就是一个函数</li>
<li>视图的参数<ul>
<li>一个HttpRequest实例</li>
<li>通过正则表达式组获取的位置参数</li>
<li>通过正则表达式组获得的关键字参数</li>
</ul>
</li>
<li>在应用目录下默认有views.py文件，一般视图都定义在这个文件中</li>
<li>如果处理功能过多，可以将函数定义到不同的py文件中</li>
</ul>
<h4 id="404-page-not-found-视图"><a href="#404-page-not-found-视图" class="headerlink" title="404 (page not found) 视图"></a>404 (page not found) 视图</h4><ul>
<li>defaults.page_not_found(request, template_name=’404.html’)</li>
<li>默认的404视图将传递一个变量给模板：request_path，它是导致错误的URL</li>
<li>如果Django在检测URLconf中的每个正则表达式后没有找到匹配的内容也将调用404视图</li>
<li>如果在settings中DEBUG设置为True，那么将永远不会调用404视图，而是显示URLconf 并带有一些调试信息</li>
<li><p>在templates中创建404.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">找不到了</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">&#123;&#123;request_path&#125;&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在settings.py中修改调试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DEBUG = False</span><br><span class="line">ALLOWED_HOSTS = [&apos;*&apos;, ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>请求一个不存在的地址</p>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/views404.jpg" alt=""></p>
<h4 id="500-server-error-视图"><a href="#500-server-error-视图" class="headerlink" title="500 (server error) 视图"></a>500 (server error) 视图</h4><ul>
<li>defaults.server_error(request, template_name=’500.html’)</li>
<li>在视图代码中出现运行时错误</li>
<li>默认的500视图不会传递变量给500.html模板</li>
<li>如果在settings中DEBUG设置为True，那么将永远不会调用505视图，而是显示URLconf 并带有一些调试信息</li>
</ul>
<h4 id="400-bad-request-视图"><a href="#400-bad-request-视图" class="headerlink" title="400 (bad request) 视图"></a>400 (bad request) 视图</h4><ul>
<li>defaults.bad_request(request, template_name=’400.html’)</li>
<li>错误来自客户端的操作</li>
<li>当用户进行的操作在安全方面可疑的时候，例如篡改会话cookie</li>
</ul>
<h3 id="Reqeust对象"><a href="#Reqeust对象" class="headerlink" title="Reqeust对象"></a>Reqeust对象</h3><h4 id="HttpReqeust对象"><a href="#HttpReqeust对象" class="headerlink" title="HttpReqeust对象"></a>HttpReqeust对象</h4><ul>
<li>服务器接收到http协议的请求后，会根据报文创建HttpRequest对象</li>
<li>视图函数的第一个参数是HttpRequest对象</li>
<li>在django.http模块中定义了HttpRequest对象的API</li>
</ul>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><ul>
<li>下面除非特别说明，属性都是只读的</li>
<li>path：一个字符串，表示请求的页面的完整路径，不包含域名</li>
<li>method：一个字符串，表示请求使用的HTTP方法，常用值包括：’GET’、’POST’</li>
<li>encoding：一个字符串，表示提交的数据的编码方式<ul>
<li>如果为None则表示使用浏览器的默认设置，一般为utf-8</li>
<li>这个属性是可写的，可以通过修改它来修改访问表单数据使用的编码，接下来对属性的任何访问将使用新的encoding值</li>
</ul>
</li>
<li>GET：一个类似于字典的对象，包含get请求方式的所有参数</li>
<li>POST：一个类似于字典的对象，包含post请求方式的所有参数</li>
<li>FILES：一个类似于字典的对象，包含所有的上传文件</li>
<li>COOKIES：一个标准的Python字典，包含所有的cookie，键和值都为字符串</li>
<li>session：一个既可读又可写的类似于字典的对象，表示当前的会话，只有当Django 启用会话的支持时才可用，详细内容见“状态保持”</li>
</ul>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul>
<li>is_ajax()：如果请求是通过XMLHttpRequest发起的，则返回True</li>
</ul>
<h4 id="QueryDict对象"><a href="#QueryDict对象" class="headerlink" title="QueryDict对象"></a>QueryDict对象</h4><ul>
<li>定义在django.http.QueryDict</li>
<li>request对象的属性GET、POST都是QueryDict类型的对象</li>
<li>与python字典不同，QueryDict类型的对象用来处理同一个键带有多个值的情况</li>
<li><p>方法get()：根据键获取值</p>
<ul>
<li>只能获取键的一个值</li>
<li>如果一个键同时拥有多个值，获取最后一个值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dict.get(&apos;键&apos;,default)</span><br><span class="line">或简写为</span><br><span class="line">dict[&apos;键&apos;] -&gt; 如果没有那个键，则会报异常。推荐使用第一种</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>方法getlist()：根据键获取值</p>
<ul>
<li>将键的值以列表返回，可以获取一个键的多个值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict.getlist(&apos;键&apos;,default)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="GET属性"><a href="#GET属性" class="headerlink" title="GET属性"></a>GET属性</h4><ul>
<li>QueryDict类型的对象</li>
<li>包含get请求方式的所有参数</li>
<li>与url请求地址中的参数对应，位于?后面</li>
<li>参数的格式是键值对，如key1=value1</li>
<li>多个参数之间，使用&amp;连接，如key1=value1&amp;key2=value2</li>
<li>键是开发人员定下来的，值是可变的</li>
<li>示例如下</li>
<li><p>创建视图getTest1用于定义链接，getTest2用于接收一键一值，getTest3用于接收一键多值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def getTest1(request):</span><br><span class="line">    return render(request,&apos;booktest/getTest1.html&apos;)</span><br><span class="line">def getTest2(request):</span><br><span class="line">    return render(request,&apos;booktest/getTest2.html&apos;)</span><br><span class="line">def getTest3(request):</span><br><span class="line">    return render(request,&apos;booktest/getTest3.html&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^getTest1/$&apos;, views.getTest1),</span><br><span class="line">url(r&apos;^getTest2/$&apos;, views.getTest2),</span><br><span class="line">url(r&apos;^getTest3/$&apos;, views.getTest3),</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建getTest1.html，定义链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">链接1：一个键传递一个值</span><br><span class="line">&lt;a href=&quot;/getTest2/?a=1&amp;b=2&quot;&gt;gettest2&lt;/a&gt;&lt;br&gt;</span><br><span class="line">链接2：一个键传递多个值</span><br><span class="line">&lt;a href=&quot;/getTest3/?a=1&amp;a=2&amp;b=3&quot;&gt;gettest3&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>完善视图getTest2的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def getTest2(request):</span><br><span class="line">    a=request.GET[&apos;a&apos;]</span><br><span class="line">    b=request.GET[&apos;b&apos;]</span><br><span class="line">    context=&#123;&apos;a&apos;:a,&apos;b&apos;:b&#125;</span><br><span class="line">    return render(request,&apos;booktest/getTest2.html&apos;,context)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建getTest2.html，显示接收结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">a:&#123;&#123; a &#125;&#125;&lt;br&gt;</span><br><span class="line">b:&#123;&#123; b &#125;&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>完善视图getTest3的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def getTest3(request):</span><br><span class="line">    a=request.GET.getlist(&apos;a&apos;)</span><br><span class="line">    b=request.GET[&apos;b&apos;]</span><br><span class="line">    context=&#123;&apos;a&apos;:a,&apos;b&apos;:b&#125;</span><br><span class="line">    return render(request,&apos;booktest/getTest3.html&apos;,context)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建getTest3.html，显示接收结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">a:&#123;% for item in a %&#125;</span><br><span class="line">&#123;&#123; item &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">b:&#123;&#123; b &#125;&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/gettest.jpg" alt=""></p>
<h4 id="POST属性"><a href="#POST属性" class="headerlink" title="POST属性"></a>POST属性</h4><ul>
<li>QueryDict类型的对象</li>
<li>包含post请求方式的所有参数</li>
<li>与form表单中的控件对应</li>
<li>控件要有name属性，则name属性的值为键，value属性的值为键，构成键值对提交<ul>
<li>对于checkbox控件，name属性一样为一组，当控件被选中后会被提交，存在一键多值的情况</li>
</ul>
</li>
<li>示例如下</li>
<li><p>定义视图postTest1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def postTest1(request):</span><br><span class="line">    return render(request,&apos;booktest/postTest1.html&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^postTest1/$&apos;,views.postTest1)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建模板postTest1.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form method=&quot;post&quot; action=&quot;/postTest2/&quot;&gt;</span><br><span class="line">    姓名：&lt;input type=&quot;text&quot; name=&quot;uname&quot;/&gt;&lt;br&gt;</span><br><span class="line">    密码：&lt;input type=&quot;password&quot; name=&quot;upwd&quot;/&gt;&lt;br&gt;</span><br><span class="line">    性别：&lt;input type=&quot;radio&quot; name=&quot;ugender&quot; value=&quot;1&quot;/&gt;男</span><br><span class="line">    &lt;input type=&quot;radio&quot; name=&quot;ugender&quot; value=&quot;0&quot;/&gt;女&lt;br&gt;</span><br><span class="line">    爱好：&lt;input type=&quot;checkbox&quot; name=&quot;uhobby&quot; value=&quot;胸口碎大石&quot;/&gt;胸口碎大石</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; name=&quot;uhobby&quot; value=&quot;跳楼&quot;/&gt;跳楼</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; name=&quot;uhobby&quot; value=&quot;喝酒&quot;/&gt;喝酒</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; name=&quot;uhobby&quot; value=&quot;爬山&quot;/&gt;爬山&lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建视图postTest2接收请求的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def postTest2(request):</span><br><span class="line">    uname=request.POST[&apos;uname&apos;]</span><br><span class="line">    upwd=request.POST[&apos;upwd&apos;]</span><br><span class="line">    ugender=request.POST[&apos;ugender&apos;]</span><br><span class="line">    uhobby=request.POST.getlist(&apos;uhobby&apos;)</span><br><span class="line">    context=&#123;&apos;uname&apos;:uname,&apos;upwd&apos;:upwd,&apos;ugender&apos;:ugender,&apos;uhobby&apos;:uhobby&#125;</span><br><span class="line">    return render(request,&apos;booktest/postTest2.html&apos;,context)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^postTest2/$&apos;,views.postTest2)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建模板postTest2.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&#123;&#123; uname &#125;&#125;&lt;br&gt;</span><br><span class="line">&#123;&#123; upwd &#125;&#125;&lt;br&gt;</span><br><span class="line">&#123;&#123; ugender &#125;&#125;&lt;br&gt;</span><br><span class="line">&#123;&#123; uhobby &#125;&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：使用表单提交，注释掉settings.py中的中间件crsf<br><img src="http://p3ek8hcdl.bkt.clouddn.com/image/jdfw.gif" alt=""></p>
</li>
</ul>
<h3 id="Response对象"><a href="#Response对象" class="headerlink" title="Response对象"></a>Response对象</h3><h4 id="HttpResponse对象"><a href="#HttpResponse对象" class="headerlink" title="HttpResponse对象"></a>HttpResponse对象</h4><ul>
<li>在django.http模块中定义了HttpResponse对象的API</li>
<li>HttpRequest对象由Django自动创建，HttpResponse对象由程序员创建</li>
<li><p>不调用模板，直接返回数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    return HttpResponse(&apos;你好&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>调用模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line">from django.template import RequestContext, loader</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    t1 = loader.get_template(&apos;polls/index.html&apos;)</span><br><span class="line">    context = RequestContext(request, &#123;&apos;h1&apos;: &apos;hello&apos;&#125;)</span><br><span class="line">    return HttpResponse(t1.render(context))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h4><ul>
<li>write(content)：以文件的方式写</li>
<li>flush()：以文件的方式输出缓存区</li>
<li>set_cookie(key, value=’’, max_age=None, expires=None, path=’/‘, domain=None, secure=None, httponly=False)：设置Cookie<ul>
<li>key、value都是字符串类型</li>
<li>max_age是一个整数，表示在指定秒数后过期</li>
<li>expires是一个datetime或timedelta对象，会话将在这个指定的日期/时间过期，注意datetime和timedelta值只有在使用PickleSerializer时才可序列化</li>
<li>max_age与expires二选一</li>
<li>如果不指定过期时间，则两个星期后过期</li>
<li>如果你想设置一个跨域的Cookie，请使用domain 参数。例如，domain=”.lawrence.com” 将设置一个www.lawrence.com、blogs.lawrence.com 和calendars.lawrence.com 都可读的Cookie。否则，Cookie 将只能被设置它的域读取。</li>
<li>如果你想阻止客服端的JavaScript 访问Cookie，可以设置httponly=True。</li>
</ul>
</li>
<li>delete_cookie(key)：删除指定的key的Cookie，如果key不存在则什么也不发生<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def cookieTest(reqeust):</span><br><span class="line">    response = HttpResponse(&apos;hello&apos;)</span><br><span class="line">    cookie = reqeust.COOKIES</span><br><span class="line">    if &apos;blog&apos; in cookie.keys():</span><br><span class="line">        response.write(&apos;&lt;h1&gt;&apos; + reqeust.COOKIES[&apos;blog&apos;] + &apos;&lt;/h1&gt;&apos;)</span><br><span class="line">    # response.set_cookie(&apos;blog&apos;, &apos;ixysec.com&apos;, 60*10)</span><br><span class="line">    return response</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="子类HttpResponseRedirect"><a href="#子类HttpResponseRedirect" class="headerlink" title="子类HttpResponseRedirect"></a>子类HttpResponseRedirect</h4><ul>
<li>Django包含了一系列的HttpResponse衍生类（子类），用来处理不同类型的HTTP 响应（response）。与 HttpResponse相同, 这些衍生类（子类）存在于django.http之中。</li>
<li>重定向，服务器端跳转</li>
<li>构造函数的第一个参数用来指定重定向的地址<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse,HttpResponseRedirect</span><br><span class="line"></span><br><span class="line">def redirect1(request):</span><br><span class="line">    return HttpResponseRedirect(&apos;/redirect2/&apos;)</span><br><span class="line"></span><br><span class="line">def redirect2(request):</span><br><span class="line">    return HttpResponse(&apos;跳转后的地址&apos;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/redirect.gif" alt=""></p>
<h4 id="子类JsonResponse"><a href="#子类JsonResponse" class="headerlink" title="子类JsonResponse"></a>子类JsonResponse</h4><ul>
<li>返回json数据，一般用于异步请求</li>
<li><em>init </em>(data)</li>
<li>帮助用户创建JSON编码的响应</li>
<li>参数data是字典对象</li>
<li>JsonResponse的默认Content-Type为application/json<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from django.http import JsonResponse</span><br><span class="line"></span><br><span class="line">def jsonTest(request):</span><br><span class="line">    return JsonResponse(&#123;&apos;data&apos;:[1,2,3,4]&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/jsontest.jpg" alt=""></p>
<h4 id="简写函数"><a href="#简写函数" class="headerlink" title="简写函数"></a>简写函数</h4><h5 id="render"><a href="#render" class="headerlink" title="render"></a>render</h5><ul>
<li>render(request, template_name[, context])</li>
<li>结合一个给定的模板和一个给定的上下文字典，并返回一个渲染后的HttpResponse对象</li>
<li>request：该request用于生成response</li>
<li>template_name：要使用的模板的完整名称</li>
<li>context：添加到模板上下文的一个字典，视图将在渲染模板之前调用它<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    return render(request, &apos;booktest/index.html&apos;, &#123;&apos;h1&apos;: &apos;hello&apos;&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h5><ul>
<li>redirect(to)</li>
<li>为传递进来的参数返回HttpResponseRedirect</li>
<li>to推荐使用反向解析<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import redirect</span><br><span class="line">from django.core.urlresolvers import reverse</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    return redirect(reverse(&apos;booktest:index2&apos;))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="状态保持"><a href="#状态保持" class="headerlink" title="状态保持"></a>状态保持</h3><ul>
<li>http协议是无状态的：每次请求都是一次新的请求，不会记得之前通信的状态</li>
<li>客户端与服务器端的一次通信，就是一次会话</li>
<li>实现状态保持的方式：在客户端或服务器端存储与会话有关的数据</li>
<li>存储方式包括cookie、session，会话一般指session对象</li>
<li>使用cookie，所有数据存储在客户端，注意不要存储敏感信息</li>
<li>推荐使用sesison方式，所有数据存储在服务器端，在客户端cookie中存储session_id -&gt;session依赖于cookie</li>
<li>状态保持的目的是在一段时间内跟踪请求者的状态，可以实现跨页面访问当前请求者的数据</li>
<li>注意：不同的请求者之间不会共享这个数据，与请求者一一对应</li>
</ul>
<h4 id="启用session"><a href="#启用session" class="headerlink" title="启用session"></a>启用session</h4><ul>
<li>使用django-admin startproject创建的项目默认启用</li>
<li><p>在settings.py文件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS列表中添加：</span><br><span class="line">&apos;django.contrib.sessions&apos;,</span><br><span class="line"></span><br><span class="line">MIDDLEWARE_CLASSES列表中添加：</span><br><span class="line">&apos;django.contrib.sessions.middleware.SessionMiddleware&apos;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>禁用会话：删除上面指定的两个值，禁用会话将节省一些性能消耗</p>
</li>
</ul>
<h4 id="使用session"><a href="#使用session" class="headerlink" title="使用session"></a>使用session</h4><ul>
<li>启用会话后，每个HttpRequest对象将具有一个session属性，它是一个类字典对象</li>
<li>get(key, default=None)：根据键获取会话的值</li>
<li>clear()：清除所有会话</li>
<li>flush()：删除当前的会话数据并删除会话的Cookie</li>
<li>del request.session[‘member_id’]：删除会话</li>
</ul>
<h4 id="用户登录示例"><a href="#用户登录示例" class="headerlink" title="用户登录示例"></a>用户登录示例</h4><ul>
<li>操作效果如下图：</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/session.gif" alt=""></p>
<ul>
<li><p>在views.py文件中创建视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render, redirect</span><br><span class="line"></span><br><span class="line">def session(request):</span><br><span class="line">    if &apos;uname&apos; in request.session.keys():</span><br><span class="line">        uname = request.session.get(&apos;uname&apos;)</span><br><span class="line">    else:</span><br><span class="line">        uname = &apos;未登录&apos;</span><br><span class="line">    return render(request, &apos;booktest/session.html&apos;, &#123;&apos;uname&apos;: uname&#125;)</span><br><span class="line"></span><br><span class="line">def session_login(request):</span><br><span class="line">    return render(request, &apos;booktest/session_login.html&apos;)</span><br><span class="line"></span><br><span class="line">def session_login_handle(request):</span><br><span class="line">    request.session[&apos;uname&apos;] = request.POST[&apos;uname&apos;]</span><br><span class="line">    return redirect(&apos;/session/&apos;)</span><br><span class="line"></span><br><span class="line">def session_logout(request):</span><br><span class="line">    del request.session[&apos;uname&apos;]</span><br><span class="line">    return redirect(&apos;/session/&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^session/$&apos;, views.session),</span><br><span class="line">    url(r&apos;^session_login/$&apos;, views.session_login),</span><br><span class="line">    url(r&apos;^session_login_handle/$&apos;, views.session_login_handle),</span><br><span class="line">    url(r&apos;^session_logout/$&apos;, views.session_logout),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建模板session.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;你好，&#123;&#123;uname&#125;&#125;&lt;/h1&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;a href=&quot;/session_login/&quot;&gt;登陆&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;/session_logout/&quot;&gt;退出&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建模板session_login.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;/session_login_handle/&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &#123;%csrf_token%&#125;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;uname&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;登陆&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="会话过期时间"><a href="#会话过期时间" class="headerlink" title="会话过期时间"></a>会话过期时间</h4><ul>
<li>set_expiry(value)：设置会话的超时时间</li>
<li>如果没有指定，则两个星期后过期</li>
<li>如果value是一个整数，会话将在values秒没有活动后过期</li>
<li>若果value是一个imedelta对象，会话将在当前时间加上这个指定的日期/时间过期</li>
<li>如果value为0，那么用户会话的Cookie将在用户的浏览器关闭时过期</li>
<li>如果value为None，那么会话永不过期</li>
<li>修改视图中session_login_handle函数，查看效果</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/sessiontest.jpg" alt=""></p>
<h4 id="存储session"><a href="#存储session" class="headerlink" title="存储session"></a>存储session</h4><ul>
<li>使用存储会话的方式，可以使用settings.py的SESSION_ENGINE项指定</li>
<li><p>基于数据库的会话：这是django默认的会话存储方式，需要添加django.contrib.sessions到的INSTALLED_APPS设置中，运行manage.py migrate在数据库中创建对应的session表，可显示指定为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE=&apos;django.contrib.sessions.backends.db&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>基于缓存的会话：只存在本地内在中，如果丢失则不能找回，比数据库的方式读写更快</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE=&apos;django.contrib.sessions.backends.cache&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以将缓存和数据库同时使用：优先从本地缓存中获取，如果没有则从数据库中获取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE=&apos;django.contrib.sessions.backends.cached_db&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/sessiondb.jpg" alt=""></p>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/sessionbase64.jpg" alt=""></p>
<h4 id="使用Redis缓存session"><a href="#使用Redis缓存session" class="headerlink" title="使用Redis缓存session"></a>使用Redis缓存session</h4><ul>
<li>会话还支持文件、纯cookie、Memcached、Redis等方式存储，下面演示使用redis存储</li>
<li><p>安装包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-redis-sessions</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改settings中的配置，增加如下项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 错误的配置 不会产生任何效果 </span><br><span class="line"># 默认就是连接的localhost 之前在ubuntu上测试成功的 所以没有察觉</span><br><span class="line"># 在windows连接ubuntu的redis一直失败 试了好久才发现这种方式根本没卵用。。。</span><br><span class="line"># SESSION_REDIS_HOST = &apos;localhost&apos;</span><br><span class="line"># SESSION_REDIS_PORT = 6379</span><br><span class="line"># SESSION_REDIS_DB = 0</span><br><span class="line"># SESSION_REDIS_PASSWORD = &apos;&apos;</span><br><span class="line"># SESSION_REDIS_PREFIX = &apos;session&apos;</span><br><span class="line"></span><br><span class="line"># 下面是正确的配置</span><br><span class="line">SESSION_ENGINE = &apos;redis_sessions.session&apos;</span><br><span class="line">SESSION_REDIS = &#123;</span><br><span class="line">    &apos;host&apos;: &apos;192.168.1.102&apos;,</span><br><span class="line">    &apos;port&apos;: 6379,</span><br><span class="line">    &apos;db&apos;: 0,</span><br><span class="line">    &apos;password&apos;: &apos;&apos;,</span><br><span class="line">    &apos;prefix&apos;: &apos;session&apos;,</span><br><span class="line">    &apos;socket_timeout&apos;: 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">服务器需要装有redis</span><br></pre></td></tr></table></figure>
</li>
<li><p>管理redis的命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">启动：sudo redis-server /etc/redis/redis.conf</span><br><span class="line">停止：sudo redis-server stop</span><br><span class="line">重启：sudo redis-server restart</span><br><span class="line"></span><br><span class="line">redis-cli：使用客户端连接服务器</span><br><span class="line">keys *：查看所有的键</span><br><span class="line">get name：获取指定键的值</span><br><span class="line">del name：删除指定名称的键</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/sessionredis.png" alt=""></p>
<h2 id="模板-1"><a href="#模板-1" class="headerlink" title="模板"></a>模板</h2><h3 id="模板介绍"><a href="#模板介绍" class="headerlink" title="模板介绍"></a>模板介绍</h3><ul>
<li>作为Web框架，Django提供了模板，可以很便利的动态生成HTML</li>
<li>模版系统致力于表达外观，而不是程序逻辑</li>
<li>模板的设计实现了业务逻辑(view)与显示内容（template）的分离，一个视图可以使用任意一个模板，一个模板可以供多个视图使用</li>
<li>模板包含<ul>
<li>HTML的静态部分</li>
<li>动态插入内容部分</li>
</ul>
</li>
<li>Django模板语言，简写DTL，定义在django.template包中</li>
<li>由startproject命令生成的settings.py定义关于模板的值：<ul>
<li>DIRS定义了一个目录列表，模板引擎按列表顺序搜索这些目录以查找模板源文件</li>
<li>APP_DIRS告诉模板引擎是否应该在每个已安装的应用中查找模板</li>
</ul>
</li>
<li>常用方式：在项目的根目录下创建templates目录，设置DIRS值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DIRS=[os.path.join(BASE_DIR,&quot;templates&quot;)]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="模板处理"><a href="#模板处理" class="headerlink" title="模板处理"></a>模板处理</h4><ul>
<li>Django处理模板分为两个阶段</li>
<li><p>Step1 加载：根据给定的标识找到模板然后预处理，通常会将它编译好放在内存中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loader.get_template(template_name)，返回一个Template对象</span><br></pre></td></tr></table></figure>
</li>
<li><p>Step2 渲染：使用Context数据对模板插值并返回生成的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Template对象的render(RequestContext)方法，使用context渲染模板</span><br></pre></td></tr></table></figure>
</li>
<li><p>加载渲染完整代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.template import loader, RequestContext</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    tem = loader.get_template(&apos;temtest/index.html&apos;)</span><br><span class="line">    context = RequestContext(request, &#123;&#125;)</span><br><span class="line">    return HttpResponse(tem.render(context))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="快捷函数"><a href="#快捷函数" class="headerlink" title="快捷函数"></a>快捷函数</h4><ul>
<li>为了减少加载模板、渲染模板的重复代码，django提供了快捷函数</li>
<li>render(request,’模板’,context)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    return render(request, &apos;temtest/index.html&apos;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="定义模板"><a href="#定义模板" class="headerlink" title="定义模板"></a>定义模板</h3><ul>
<li>模板语言包括<ul>
<li>变量</li>
<li>标签 { % 代码块 % }</li>
<li>过滤器</li>
<li>注释</li>
</ul>
</li>
</ul>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><ul>
<li><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; variable &#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当模版引擎遇到一个变量，将计算这个变量，然后将结果输出</p>
</li>
<li>变量名必须由字母、数字、下划线（不能以下划线开头）和点组成</li>
<li>当模版引擎遇到点(“.”)，会按照下列顺序查询：<ol>
<li>字典查询，例如：foo[“bar”]</li>
<li>属性或方法查询，例如：foo.bar</li>
<li>数字索引查询，例如：foo[bar]</li>
</ol>
</li>
<li>如果变量不存在， 模版系统将插入’’ (空字符串)</li>
<li>在模板中调用方法时不能传递参数</li>
</ul>
<h5 id="在模板中调用对象的方法"><a href="#在模板中调用对象的方法" class="headerlink" title="在模板中调用对象的方法"></a>在模板中调用对象的方法</h5><ul>
<li><p>在models.py中定义类HeroInfo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class HeroInfo(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    def showName(self):</span><br><span class="line">        return self.hname</span><br></pre></td></tr></table></figure>
</li>
<li><p>在views.py中传递HeroInfo对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line">from models import *</span><br><span class="line"></span><br><span class="line">def templatesTest(request):</span><br><span class="line">    hero = HeroInfo(hname=&apos;ixysec&apos;)</span><br><span class="line">    context = &#123;&apos;hero&apos;:hero&#125;</span><br><span class="line">    return render(request, &apos;booktest/templatesTest.html&apos;, context)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在模板templatesTest.html中调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;hero.showName&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/templatestest.jpg" alt=""></p>
<h4 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h4><ul>
<li>语法：{ % tag % }</li>
<li>作用<ul>
<li>在输出中创建文本</li>
<li>控制循环或逻辑</li>
<li>加载外部信息到模板中供以后的变量使用</li>
</ul>
</li>
<li>for标签<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; %for ... in ...%&#125;</span><br><span class="line">循环逻辑</span><br><span class="line">&#123;&#123;forloop.counter&#125;&#125;表示当前是第几次循环</span><br><span class="line">&#123; %empty%&#125;</span><br><span class="line">给出的列表为或列表不存在时，执行此处</span><br><span class="line">&#123; %endfor%&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/forTest.jpg" alt=""></p>
<ul>
<li>if标签<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123; %if ...%&#125;</span><br><span class="line">逻辑1</span><br><span class="line">&#123; %elif ...%&#125;</span><br><span class="line">逻辑2</span><br><span class="line">&#123; %else%&#125;</span><br><span class="line">逻辑3</span><br><span class="line">&#123; %endif%&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/iftest.jpg" alt=""></p>
<ul>
<li><p>comment标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; % comment % &#125;</span><br><span class="line">多行注释</span><br><span class="line">&#123; % endcomment % &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>include：加载模板并以标签内的参数渲染</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%include &quot;foo/bar.html&quot; %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>url：反向解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% url &apos;name&apos; p1 p2 %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>csrf_token：这个标签用于跨站请求伪造保护</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% csrf_token %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>布尔标签：and、or，and比or的优先级高</p>
</li>
<li>block、extends：详见“模板继承”</li>
<li>autoescape：详见“HTML转义”</li>
</ul>
<h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><ul>
<li>语法：{ { 变量|过滤器 }}，例如{ { name|lower }}，表示将变量name的值变为小写输出</li>
<li>使用管道符号 (|)来应用过滤器</li>
<li>通过使用过滤器来改变变量的计算结果</li>
<li><p>可以在if标签中使用过滤器结合运算符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if list1|length &gt; 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤器能够被“串联”，构成过滤器链</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name|lower|upper</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤器可以传递参数，参数使用引号包起来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list|join:&quot;,&quot;</span><br><span class="line">如果list是列表[&apos;a&apos;， &apos;b&apos;， &apos;c&apos;] ，输出将是字符串&apos;a,b,c&apos;。</span><br></pre></td></tr></table></figure>
</li>
<li><p>default：如果一个变量没有被提供，或者值为false或空，则使用默认值，否则使用变量的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value|default:&quot;什么也没有&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>date：根据给定格式对一个date变量格式化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value|date:&apos;Y-m-d&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><a href="http://python.usyiyi.cn/documents/django_182/ref/templates/builtins.html" target="_blank" rel="noopener">过滤器</a></p>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><ul>
<li><p>单行注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;#...#&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注释可以包含任何模版代码，有效的或者无效的都可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;# &#123; % if foo % &#125;bar&#123; % else % &#125; #&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用comment标签注释模版中的多行内容</p>
</li>
</ul>
<h3 id="反向解析"><a href="#反向解析" class="headerlink" title="反向解析"></a>反向解析</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">返回一个绝对路径的引用(不包含域名的URL)，该引用匹配一个给定的视图函数和一些可选的参数。</span><br><span class="line">它可以避免在模板中硬编码链接路径。</span><br><span class="line">&#123;% url &apos;myapp:view-name&apos; p1 p2 %&#125;</span><br><span class="line">警告</span><br><span class="line">不要忘记在函数路径或模式名称周围加引号，否则值将被解释为上下文变量！</span><br></pre></td></tr></table></figure>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/urltest.png" alt=""></p>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/urltest1.jpg" alt=""></p>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/urltest2.jpg" alt=""></p>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/urltest3.jpg" alt=""></p>
<h3 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h3><ul>
<li>模板继承可以减少页面内容的重复定义，实现页面内容的重用</li>
<li>典型应用：网站的头部、尾部是一样的，这些内容可以定义在父模板中，子模板不需要重复定义</li>
<li>block标签：在父模板中预留区域，在子模板中填充</li>
<li>extends继承：继承，写在模板文件的第一行</li>
<li><p>定义父模板base.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123; %block block_name%&#125;</span><br><span class="line">这里可以定义默认值</span><br><span class="line">如果不定义默认值，则表示空字符串</span><br><span class="line">&#123; %endblock%&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义子模板index.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; % extends &quot;base.html&quot; %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在子模板中使用block填充预留区域</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; %block block_name%&#125;</span><br><span class="line">实际填充内容</span><br><span class="line">&#123; %endblock%&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><ul>
<li>如果在模版中使用extends标签，它必须是模版中的第一个标签</li>
<li>不能在一个模版中定义多个相同名字的block标签</li>
<li>子模版不必定义全部父模版中的blocks，如果子模版没有定义block，则使用了父模版中的默认值</li>
<li>如果发现在模板中大量的复制内容，那就应该把内容移动到父模板中</li>
<li>使用可以获取父模板中block的内容</li>
<li>为了更好的可读性，可以给endblock标签一个名字<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; % block block_name %&#125;</span><br><span class="line">区域内容</span><br><span class="line">&#123; % endblock block_name %&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="HTML转义"><a href="#HTML转义" class="headerlink" title="HTML转义"></a>HTML转义</h3><ul>
<li><p>Django对字符串进行自动HTML转义，如在模板中输出如下值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">视图代码：</span><br><span class="line">def index(request):</span><br><span class="line">    return render(request, &apos;temtest/index2.html&apos;,</span><br><span class="line">                  &#123;</span><br><span class="line">                      &apos;t1&apos;: &apos;&lt;h1&gt;hello&lt;/h1&gt;&apos;</span><br><span class="line">                  &#125;)</span><br><span class="line">模板代码：</span><br><span class="line">&#123;&#123;t1&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示效果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;hello&lt;/h1&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="会被自动转义的字符"><a href="#会被自动转义的字符" class="headerlink" title="会被自动转义的字符"></a>会被自动转义的字符</h4><ul>
<li>html转义，就是将包含的html标签输出，而不被解释执行，原因是当显示用户提交字符串时，可能包含一些攻击性的代码，如js脚本</li>
<li><p>Django会将如下字符自动转义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; 会转换为&amp;lt;</span><br><span class="line"></span><br><span class="line">&gt; 会转换为&amp;gt;</span><br><span class="line"></span><br><span class="line">&apos; (单引号) 会转换为&amp;#39;</span><br><span class="line"></span><br><span class="line">&quot; (双引号)会转换为 &amp;quot;</span><br><span class="line"></span><br><span class="line">&amp; 会转换为 &amp;amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当显示不被信任的变量时使用escape过滤器，一般省略，因为Django自动转义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;t1|escape&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="关闭转义"><a href="#关闭转义" class="headerlink" title="关闭转义"></a>关闭转义</h4><ul>
<li><p>对于变量使用safe过滤器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; data|safe &#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于代码块使用autoescape标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; % autoescape off %&#125;</span><br><span class="line">&#123;&#123; body &#125;&#125;</span><br><span class="line">&#123; % endautoescape %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>标签autoescape接受on或者off参数</p>
</li>
<li>自动转义标签在base模板中关闭，在child模板中也是关闭的</li>
</ul>
<h4 id="手动转义"><a href="#手动转义" class="headerlink" title="手动转义"></a>手动转义</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; &#123; data|default:&quot;&lt;b&gt;123&lt;/b&gt;&quot; &#125;&#125;</span><br><span class="line">应写为</span><br><span class="line">&#123; &#123; data|default:&quot;&amp;lt;b&amp;gt;123&amp;lt;/b&amp;gt;&quot; &#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/htmltest.jpg" alt=""></p>
<h3 id="csrf"><a href="#csrf" class="headerlink" title="csrf"></a>csrf</h3><ul>
<li>全称Cross Site Request Forgery，跨站请求伪造</li>
<li>某些恶意网站上包含链接、表单按钮或者JavaScript，它们会利用登录过的用户在浏览器中的认证信息试图在你的网站上完成某些操作，这就是跨站攻击</li>
<li>演示csrf如下</li>
<li><p>创建视图csrf1用于展示表单，csrf2用于接收post请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def csrf1(request):</span><br><span class="line">    return render(request,&apos;booktest/csrf1.html&apos;)</span><br><span class="line">def csrf2(request):</span><br><span class="line">    uname=request.POST[&apos;uname&apos;]</span><br><span class="line">    return render(request,&apos;booktest/csrf2.html&apos;,&#123;&apos;uname&apos;:uname&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^csrf1/$&apos;, views.csrf1),</span><br><span class="line">url(r&apos;^csrf2/$&apos;, views.csrf2),</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建模板csrf1.html用于展示表单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form method=&quot;post&quot; action=&quot;/crsf2/&quot;&gt;</span><br><span class="line">    &lt;input name=&quot;uname&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建模板csrf2用于展示接收的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&#123;&#123; uname &#125;&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在浏览器中访问，查看效果，报错如下：<br><img src="http://p3ek8hcdl.bkt.clouddn.com/image/csrf1.png" alt=""></p>
</li>
<li><p>将settings.py中的中间件代码’django.middleware.csrf.CsrfViewMiddleware’注释</p>
</li>
<li>查看csrf1的源代码，复制，在自己的网站内建一个html文件，粘贴源码，访问查看效果</li>
</ul>
<h4 id="防csrf的使用"><a href="#防csrf的使用" class="headerlink" title="防csrf的使用"></a>防csrf的使用</h4><ul>
<li>在django的模板中，提供了防止跨站请求伪造攻击的方法，使用步骤如下：</li>
<li>step1：在settings.py中启用’django.middleware.csrf.CsrfViewMiddleware’中间件，此项在创建项目时，默认被启用</li>
<li><p>step2：在csrf1.html中添加标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;</span><br><span class="line">&#123;% csrf_token %&#125;</span><br><span class="line">...</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>step3：测试刚才的两个请求，发现跨站的请求被拒绝了，效果如下图</p>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/csrf2.png" alt=""></p>
<h4 id="取消保护"><a href="#取消保护" class="headerlink" title="取消保护"></a>取消保护</h4><ul>
<li><p>如果某些视图不需要保护，可以使用装饰器csrf_exempt，模板中也不需要写标签，修改csrf2的视图如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from django.views.decorators.csrf import csrf_exempt</span><br><span class="line"></span><br><span class="line">@csrf_exempt</span><br><span class="line">def csrf2(request):</span><br><span class="line">    uname=request.POST[&apos;uname&apos;]</span><br><span class="line">    return render(request,&apos;booktest/csrf2.html&apos;,&#123;&apos;uname&apos;:uname&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行上面的两个请求，发现都可以请求</p>
</li>
</ul>
<h4 id="保护原理"><a href="#保护原理" class="headerlink" title="保护原理"></a>保护原理</h4><ul>
<li><p>加入标签后，可以查看源代码，发现多了如下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&apos;hidden&apos; name=&apos;csrfmiddlewaretoken&apos; value=&apos;nGjAB3Md9ZSb4NmG1sXDolPmh3bR2g59&apos; /&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在浏览器的调试工具中，通过network标签可以查看cookie信息</p>
</li>
<li>本站中自动添加了cookie信息，如下图</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/csrf3.png" alt=""></p>
<ul>
<li>查看跨站的信息，并没有cookie信息，即使加入上面的隐藏域代码，发现又可以访问了</li>
<li>结论：django的csrf不是完全的安全</li>
<li>当提交请求时，中间件’django.middleware.csrf.CsrfViewMiddleware’会对提交的cookie及隐藏域的内容进行验证，如果失败则返回403错误</li>
</ul>
<h3 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h3><ul>
<li>在用户注册、登录页面，为了防止暴力请求，可以加入验证码功能，如果验证码错误，则不需要继续处理，可以减轻一些服务器的压力</li>
<li>使用验证码也是一种有效的防止crsf的方法</li>
<li>验证码效果如下图：</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/verifycode.png" alt=""></p>
<h4 id="验证码视图"><a href="#验证码视图" class="headerlink" title="验证码视图"></a>验证码视图</h4><ul>
<li>新建viewsUtil.py，定义函数verifycode</li>
<li>此段代码用到了PIL中的Image、ImageDraw、ImageFont模块，需要先安装Pillow（3.4.1）包，详细文档参考<a href="http://pillow.readthedocs.io" target="_blank" rel="noopener">http://pillow.readthedocs.io</a></li>
<li>Image表示画布对象</li>
<li>ImageDraw表示画笔对象</li>
<li>ImageFont表示字体对象，ubuntu的字体路径为“/usr/share/fonts/truetype/freefont”</li>
<li>代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line">def verifycode(request):</span><br><span class="line">    #引入绘图模块</span><br><span class="line">    from PIL import Image, ImageDraw, ImageFont</span><br><span class="line">    #引入随机函数模块</span><br><span class="line">    import random</span><br><span class="line">    #定义变量，用于画面的背景色、宽、高</span><br><span class="line">    bgcolor = (random.randrange(20, 100), random.randrange(</span><br><span class="line">        20, 100), 255)</span><br><span class="line">    width = 100</span><br><span class="line">    height = 25</span><br><span class="line">    #创建画面对象</span><br><span class="line">    im = Image.new(&apos;RGB&apos;, (width, height), bgcolor)</span><br><span class="line">    #创建画笔对象</span><br><span class="line">    draw = ImageDraw.Draw(im)</span><br><span class="line">    #调用画笔的point()函数绘制噪点</span><br><span class="line">    for i in range(0, 100):</span><br><span class="line">        xy = (random.randrange(0, width), random.randrange(0, height))</span><br><span class="line">        fill = (random.randrange(0, 255), 255, random.randrange(0, 255))</span><br><span class="line">        draw.point(xy, fill=fill)</span><br><span class="line">    #定义验证码的备选值</span><br><span class="line">    str1 = &apos;ABCD123EFGHIJK456LMNOPQRS789TUVWXYZ0&apos;</span><br><span class="line">    #随机选取4个值作为验证码</span><br><span class="line">    rand_str = &apos;&apos;</span><br><span class="line">    for i in range(0, 4):</span><br><span class="line">        rand_str += str1[random.randrange(0, len(str1))]</span><br><span class="line">    #构造字体对象</span><br><span class="line">    font = ImageFont.truetype(&apos;FreeMono.ttf&apos;, 23)</span><br><span class="line">    #构造字体颜色</span><br><span class="line">    fontcolor = (255, random.randrange(0, 255), random.randrange(0, 255))</span><br><span class="line">    #绘制4个字</span><br><span class="line">    draw.text((5, 2), rand_str[0], font=font, fill=fontcolor)</span><br><span class="line">    draw.text((25, 2), rand_str[1], font=font, fill=fontcolor)</span><br><span class="line">    draw.text((50, 2), rand_str[2], font=font, fill=fontcolor)</span><br><span class="line">    draw.text((75, 2), rand_str[3], font=font, fill=fontcolor)</span><br><span class="line">    #释放画笔</span><br><span class="line">    del draw</span><br><span class="line">    #存入session，用于做进一步验证</span><br><span class="line">    request.session[&apos;verifycode&apos;] = rand_str</span><br><span class="line">    #内存文件操作</span><br><span class="line">    import cStringIO</span><br><span class="line">    buf = cStringIO.StringIO()</span><br><span class="line">    #将图片保存在内存中，文件类型为png</span><br><span class="line">    im.save(buf, &apos;png&apos;)</span><br><span class="line">    #将内存中的图片数据返回给客户端，MIME类型为图片png</span><br><span class="line">    return HttpResponse(buf.getvalue(), &apos;image/png&apos;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">python3中需要把import cStringIO换成io  StringIO换成BytesIO</span><br><span class="line">#内存文件操作</span><br><span class="line">    import io</span><br><span class="line">    buf = io.BytesIO()</span><br><span class="line">    #将图片保存在内存中，文件类型为png</span><br><span class="line">    im.save(buf, &apos;png&apos;)</span><br><span class="line">    #将内存中的图片数据返回给客户端，MIME类型为图片png</span><br><span class="line">    return HttpResponse(buf.getvalue(), &apos;image/png&apos;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="配置url"><a href="#配置url" class="headerlink" title="配置url"></a>配置url</h4><ul>
<li>在urls.py中定义请求验证码视图的url<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from . import viewsUtil</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^verifycode/$&apos;, viewsUtil.verifycode),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="显示验证码"><a href="#显示验证码" class="headerlink" title="显示验证码"></a>显示验证码</h4><ul>
<li><p>在模板中使用img标签，src指向验证码视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img id=&apos;verifycode&apos; src=&quot;/verifycode/&quot; alt=&quot;CheckCode&quot;/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务器，查看显示成功</p>
</li>
<li><p>扩展：点击“看不清，换一个”时，可以换一个新的验证码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/static/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    $(function()&#123;</span><br><span class="line">        $(&apos;#verifycodeChange&apos;).css(&apos;cursor&apos;,&apos;pointer&apos;).click(function() &#123;</span><br><span class="line">            $(&apos;#verifycode&apos;).attr(&apos;src&apos;,$(&apos;#verifycode&apos;).attr(&apos;src&apos;)+1)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;img id=&apos;verifycode&apos; src=&quot;/verifycode/?1&quot; alt=&quot;CheckCode&quot;/&gt;</span><br><span class="line">&lt;span id=&apos;verifycodeChange&apos;&gt;看不清，换一个&lt;/span&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>为了能够实现提交功能，需要增加form和input标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method=&apos;post&apos; action=&apos;/verifycodeValid/&apos;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;vc&quot;&gt;</span><br><span class="line">    &lt;img id=&apos;verifycode&apos; src=&quot;/verifycode/?1&quot; alt=&quot;CheckCode&quot;/&gt;</span><br><span class="line">&lt;span id=&apos;verifycodeChange&apos;&gt;看不清，换一个&lt;/span&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><ul>
<li><p>接收请求的信息，与session中的内容对比</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line"></span><br><span class="line">def verifycodeValid(request):</span><br><span class="line">    vc = request.POST[&apos;vc&apos;]</span><br><span class="line">    if vc.upper() == request.session[&apos;verifycode&apos;]:</span><br><span class="line">        return HttpResponse(&apos;ok&apos;)</span><br><span class="line">    else:</span><br><span class="line">        return HttpResponse(&apos;no&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置验证处理的url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^verifycodeValid/$&apos;, views.verifycodeValid),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h2><h3 id="静态文件处理"><a href="#静态文件处理" class="headerlink" title="静态文件处理"></a>静态文件处理</h3><ul>
<li>项目中的CSS、图片、js都是静态文件</li>
</ul>
<h4 id="配置静态文件"><a href="#配置静态文件" class="headerlink" title="配置静态文件"></a>配置静态文件</h4><ul>
<li><p>在settings 文件中定义静态内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = &apos;/static/&apos;</span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, &apos;static&apos;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>在项目根目录下创建static目录，再创建当前应用名称的目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysite/static/myapp/</span><br></pre></td></tr></table></figure>
</li>
<li><p>在模板中可以使用硬编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/static/my_app/myexample.jpg</span><br></pre></td></tr></table></figure>
</li>
<li><p>在模板中可以使用static模板标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; % load static from staticfiles %&#125;</span><br><span class="line">&lt;img src=&quot;&#123; % static &quot;my_app/myexample.jpg&quot; %&#125;&quot; alt=&quot;My image&quot;/&gt;</span><br><span class="line">会自动根据STATIC_URL生成url</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><ul>
<li>是一个轻量级、底层的插件系统，可以介入Django的请求和响应处理过程，修改Django的输入或输出</li>
<li>激活：添加到Django配置文件中的MIDDLEWARE_CLASSES元组中</li>
<li>每个中间件组件是一个独立的Python类，可以定义下面方法中的一个或多个<ul>
<li><em>init </em>：无需任何参数，服务器响应第一个请求的时候调用一次，用于确定是否启用当前中间件</li>
<li>process_request(request)：执行视图之前被调用，在每个请求上调用，返回None或HttpResponse对象</li>
<li>process_view(request, view_func, view_args, view_kwargs)：调用视图之前被调用，在每个请求上调用，返回None或HttpResponse对象</li>
<li>process_template_response(request, response)：在视图刚好执行完毕之后被调用，在每个请求上调用，返回实现了render方法的响应对象</li>
<li>process_response(request, response)：所有响应返回浏览器之前被调用，在每个请求上调用，返回HttpResponse对象</li>
<li>process_exception(request,response,exception)：当视图抛出异常时调用，在每个请求上调用，返回一个HttpResponse对象</li>
</ul>
</li>
<li>使用中间件，可以干扰整个处理过程，每次请求中都会执行中间件的这个方法</li>
<li>示例：自定义异常处理</li>
<li><p>与settings.py同级目录下创建myexception.py文件，定义类MyException，实现process_exception方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line">class MyException():</span><br><span class="line">    def process_exception(request,response, exception):</span><br><span class="line">        return HttpResponse(exception.message)</span><br></pre></td></tr></table></figure>
</li>
<li><p>将类MyException注册到settings.py中间件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE_CLASSES = (</span><br><span class="line">    &apos;test1.myexception.MyException&apos;,</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义视图，并发生一个异常信息，则会运行自定义的异常处理</p>
</li>
</ul>
<h3 id="上传图片"><a href="#上传图片" class="headerlink" title="上传图片"></a>上传图片</h3><ul>
<li>当Django在处理文件上传的时候，文件数据被保存在request.FILES</li>
<li>FILES中的每个键为<input type="file" name="">中的name</li>
<li>注意：FILES只有在请求的方法为POST 且提交的<form>带有enctype=”multipart/form-data” 的情况下才会包含数据。否则，FILES 将为一个空的类似于字典的对象</form></li>
<li><p>使用模型处理上传文件：将属性定义成models.ImageField类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pic=models.ImageField(upload_to=&apos;cars/&apos;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：如果属性类型为ImageField需要安装包Pillow</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pillow</span><br></pre></td></tr></table></figure>
</li>
<li><p>图片存储路径</p>
<ul>
<li>在项目根目录下创建media文件夹</li>
<li>图片上传后，会被保存到“/static/media/cars/图片文件”</li>
<li>打开settings.py文件，增加media_root项<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MEDIA_ROOT=os.path.join(BASE_DIR,&quot;static/media&quot;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>使用django后台管理，遇到ImageField类型的属性会出现一个file框，完成文件上传</p>
</li>
<li><p>手动上传的模板代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;文件上传&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form method=&quot;post&quot; action=&quot;upload/&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; name=&quot;title&quot;&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=&quot;file&quot; name=&quot;pic&quot;/&gt;&lt;br&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;上传&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>手动上传的视图代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from django.conf import settings</span><br><span class="line"></span><br><span class="line">def upload(request):</span><br><span class="line">    if request.method == &quot;POST&quot;:</span><br><span class="line">        f1 = request.FILES[&apos;pic&apos;]</span><br><span class="line">        fname = &apos;%s/cars/%s&apos; % (settings.MEDIA_ROOT,f1.name)</span><br><span class="line">        # python3中需‘wb’模式打开</span><br><span class="line">        with open(fname, &apos;w&apos;) as pic:</span><br><span class="line">            for c in f1.chunks():</span><br><span class="line">                pic.write(c)</span><br><span class="line">        return HttpResponse(&quot;ok&quot;)</span><br><span class="line">    else:</span><br><span class="line">        return HttpResponse(&quot;error&quot;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Admin站点"><a href="#Admin站点" class="headerlink" title="Admin站点"></a>Admin站点</h3><ul>
<li>通过使用startproject创建的项目模版中，默认Admin被启用</li>
<li><p>1.创建管理员的用户名和密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br><span class="line">然后按提示填写用户名、邮箱、密码</span><br></pre></td></tr></table></figure>
</li>
<li><p>2.在应用内admin.py文件完成注册，就可以在后台管理中维护模型的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib import admin</span><br><span class="line">from models import *</span><br><span class="line"></span><br><span class="line">admin.site.register(HeroInfo)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查找admin文件：在INSTALLED_APPS项中加入django.contrib.admin，Django就会自动搜索每个应用的admin模块并将其导入</p>
</li>
</ul>
<h4 id="ModelAdmin对象"><a href="#ModelAdmin对象" class="headerlink" title="ModelAdmin对象"></a>ModelAdmin对象</h4><ul>
<li>ModelAdmin类是模型在Admin界面中的表示形式</li>
<li><p>定义：定义一个类，继承于admin.ModelAdmin，注册模型时使用这个类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>通常定义在应用的admin.py文件里</p>
</li>
<li><p>使用方式一：注册参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin.site.register(HeroInfo,HeroAdmin)</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用方式二：注册装饰器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@admin.register(HeroInfo)</span><br><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过重写admin.ModelAdmin的属性规定显示效果，属性主要分为列表页、增加修改页两部分</p>
</li>
</ul>
<h4 id="列表页选项"><a href="#列表页选项" class="headerlink" title="列表页选项"></a>列表页选项</h4><h5 id="“操作选项”的位置"><a href="#“操作选项”的位置" class="headerlink" title="“操作选项”的位置"></a>“操作选项”的位置</h5><ul>
<li>actions_on_top、actions_on_bottom：默认显示在页面的顶部<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br><span class="line">    actions_on_top = True</span><br><span class="line">    actions_on_bottom = True</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="list-display"><a href="#list-display" class="headerlink" title="list_display"></a>list_display</h5><ul>
<li>出现列表中显示的字段</li>
<li>列表类型</li>
<li>在列表中，可以是字段名称，也可以是方法名称，但是方法名称默认不能排序</li>
<li><p>在方法中可以使用format_html()输出html内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">在models.py文件中</span><br><span class="line">from django.db import models</span><br><span class="line">from tinymce.models import HTMLField</span><br><span class="line">from django.utils.html import format_html</span><br><span class="line"></span><br><span class="line">class HeroInfo(models.Model):</span><br><span class="line">    hname = models.CharField(max_length=10)</span><br><span class="line">    hcontent = HTMLField()</span><br><span class="line">    isDelete = models.BooleanField()</span><br><span class="line">    def hContent(self):</span><br><span class="line">        return format_html(self.hcontent)</span><br><span class="line"></span><br><span class="line">在admin.py文件中</span><br><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br><span class="line">    list_display = [&apos;hname&apos;, &apos;hContent&apos;]</span><br></pre></td></tr></table></figure>
</li>
<li><p>让方法排序，为方法指定admin_order_field属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在models.py中HeroInfo类的代码改为如下：</span><br><span class="line">    def hContent(self):</span><br><span class="line">        return format_html(self.hcontent)</span><br><span class="line">    hContent.admin_order_field = &apos;hname&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>标题栏名称：将字段封装成方法，为方法设置short_description属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在models.py中为HeroInfo类增加方法hName：</span><br><span class="line">    def hName(self):</span><br><span class="line">        return self.hname</span><br><span class="line">    hName.short_description = &apos;姓名&apos;</span><br><span class="line">    hContent.short_description = &apos;内容&apos;</span><br><span class="line"></span><br><span class="line">在admin.py页中注册</span><br><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br><span class="line">    list_display = [&apos;hName&apos;, &apos;hContent&apos;]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="list-filter"><a href="#list-filter" class="headerlink" title="list_filter"></a>list_filter</h5><ul>
<li>右侧栏过滤器，对哪些属性的值进行过滤</li>
<li>列表类型</li>
<li>只能接收字段<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br><span class="line">    ...</span><br><span class="line">    list_filter = [&apos;hname&apos;, &apos;hcontent&apos;]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="list-per-page"><a href="#list-per-page" class="headerlink" title="list_per_page"></a>list_per_page</h5><ul>
<li>每页中显示多少项，默认设置为100<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br><span class="line">    ...</span><br><span class="line">    list_per_page = 10</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="search-fields"><a href="#search-fields" class="headerlink" title="search_fields"></a>search_fields</h5><ul>
<li>搜索框</li>
<li>列表类型，表示在这些字段上进行搜索</li>
<li>只能接收字段<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br><span class="line">    ...</span><br><span class="line">    search_fields = [&apos;hname&apos;]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="增加与修改页选项"><a href="#增加与修改页选项" class="headerlink" title="增加与修改页选项"></a>增加与修改页选项</h4><ul>
<li><p>fields：显示字段的顺序，如果使用元组表示显示到一行上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br><span class="line">    ...</span><br><span class="line">    fields = [(&apos;hname&apos;, &apos;hcontent&apos;)]</span><br></pre></td></tr></table></figure>
</li>
<li><p>fieldsets：分组显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class HeroAdmin(admin.ModelAdmin):</span><br><span class="line">    ...</span><br><span class="line">    fieldsets = (</span><br><span class="line">        (&apos;base&apos;, &#123;&apos;fields&apos;: (&apos;hname&apos;,)&#125;),</span><br><span class="line">        (&apos;other&apos;, &#123;&apos;fields&apos;: (&apos;hcontent&apos;,)&#125;),</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
</li>
<li><p>fields与fieldsets两者选一</p>
</li>
</ul>
<h4 id="InlineModelAdmin对象"><a href="#InlineModelAdmin对象" class="headerlink" title="InlineModelAdmin对象"></a>InlineModelAdmin对象</h4><ul>
<li>类型InlineModelAdmin：表示在模型的添加或修改页面嵌入关联模型的添加或修改</li>
<li>子类TabularInline：以表格的形式嵌入</li>
<li>子类StackedInline：以块的形式嵌入<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class HeroInline(admin.TabularInline):</span><br><span class="line">    model = HeroInfo</span><br><span class="line"></span><br><span class="line">class BookAdmin(admin.ModelAdmin):</span><br><span class="line">    inlines = [</span><br><span class="line">        HeroInline,</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="重写admin模板"><a href="#重写admin模板" class="headerlink" title="重写admin模板"></a>重写admin模板</h4><ul>
<li>在项目所在目录中创建templates目录，再创建一个admin目录</li>
<li><p>设置模板查找目录：修改settings.py的TEMPLATES项，加载模板时会在DIRS列表指定的目录中搜索</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;DIRS&apos;: [os.path.join(BASE_DIR, &apos;templates&apos;)],</span><br></pre></td></tr></table></figure>
</li>
<li><p>从Django安装的目录下（django/contrib/admin/templates）将模板页面的源文件admin/base_site.html拷贝到第一步建好的目录里</p>
</li>
<li>编辑base_site.html文件</li>
<li>刷新页面，发现以刚才编辑的页面效果显示</li>
<li>其它管理后台的模板可以按照相同的方式进行修改</li>
</ul>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><ul>
<li>Django提供了一些类实现管理数据分页，这些类位于django/core/paginator.py中</li>
</ul>
<h4 id="Paginator对象"><a href="#Paginator对象" class="headerlink" title="Paginator对象"></a>Paginator对象</h4><ul>
<li>Paginator(列表,int)：返回分页对象，参数为列表数据，每页数据的条数</li>
</ul>
<h5 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h5><ul>
<li>count：对象总数</li>
<li>num_pages：页面总数</li>
<li>page_range：页码列表，从1开始，例如[1, 2, 3, 4]</li>
</ul>
<h5 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h5><ul>
<li>page(num)：下标以1开始，如果提供的页码不存在，抛出InvalidPage异常</li>
</ul>
<h5 id="异常exception"><a href="#异常exception" class="headerlink" title="异常exception"></a>异常exception</h5><ul>
<li>InvalidPage：当向page()传入一个无效的页码时抛出</li>
<li>PageNotAnInteger：当向page()传入一个不是整数的值时抛出</li>
<li>EmptyPage：当向page()提供一个有效值，但是那个页面上没有任何对象时抛出</li>
</ul>
<h4 id="Page对象"><a href="#Page对象" class="headerlink" title="Page对象"></a>Page对象</h4><h5 id="创建对象-1"><a href="#创建对象-1" class="headerlink" title="创建对象"></a>创建对象</h5><ul>
<li>Paginator对象的page()方法返回Page对象，不需要手动构造</li>
</ul>
<h5 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h5><ul>
<li>object_list：当前页上所有对象的列表</li>
<li>number：当前页的序号，从1开始</li>
<li>paginator：当前page对象相关的Paginator对象</li>
</ul>
<h5 id="方法-3"><a href="#方法-3" class="headerlink" title="方法"></a>方法</h5><ul>
<li>has_next()：如果有下一页返回True</li>
<li>has_previous()：如果有上一页返回True</li>
<li>has_other_pages()：如果有上一页或下一页返回True</li>
<li>next_page_number()：返回下一页的页码，如果下一页不存在，抛出InvalidPage异常</li>
<li>previous_page_number()：返回上一页的页码，如果上一页不存在，抛出InvalidPage异常</li>
<li>len()：返回当前页面对象的个数</li>
<li>迭代页面对象：访问当前页面中的每个对象</li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><ul>
<li><p>创建视图pagTest</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def pagTest(request, pindex):</span><br><span class="line">    list = HeroInfo.objects.all()</span><br><span class="line">    p = Paginator(list, 4)</span><br><span class="line">    if pindex == &apos;&apos;:</span><br><span class="line">        pindex = &apos;1&apos;</span><br><span class="line">    pindex = int(pindex)</span><br><span class="line">    page = p.page(pindex)</span><br><span class="line">    plist = p.page_range</span><br><span class="line">    context = &#123;</span><br><span class="line">        &apos;page&apos;:page,</span><br><span class="line">        &apos;plist&apos;:plist,</span><br><span class="line">        &apos;pindex&apos;:pindex</span><br><span class="line">    &#125;</span><br><span class="line">    return render(request, &apos;booktest/pagtest.html&apos;, context)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^pagTest(\d*)/$&apos;, views.pagTest),</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义模板pagTest.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;%for hero in page%&#125;</span><br><span class="line">    &lt;li&gt;&#123;&#123;hero.hname&#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123;%endfor%&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&#123;%if page.has_previous%&#125; &lt;!-- 有上一页的话才显示‘上一页’ --&gt;</span><br><span class="line">&lt;a href=&quot;/pagTest&#123;&#123;page.previous_page_number&#125;&#125;/&quot;&gt;上一页&lt;/a&gt;</span><br><span class="line">&#123;%endif%&#125;</span><br><span class="line">&#123;%for p in plist%&#125; &lt;!-- 循环页码列表 --&gt;</span><br><span class="line">&#123;%if pindex == p%&#125; &lt;!-- 当前页面不给链接 --&gt;</span><br><span class="line">&lt;a&gt;第&#123;&#123;p&#125;&#125;页&lt;/a&gt;</span><br><span class="line">&#123;%else%&#125;</span><br><span class="line">&lt;a href=&quot;/pagTest&#123;&#123;p&#125;&#125;/&quot;&gt;第&#123;&#123;p&#125;&#125;页&lt;/a&gt;</span><br><span class="line">&#123;%endif%&#125;</span><br><span class="line">&#123;%endfor%&#125;</span><br><span class="line">&#123;%if page.has_next%&#125; &lt;!-- 有下一页的话才显示‘下一页’ --&gt;</span><br><span class="line">&lt;a href=&quot;/pagTest&#123;&#123;page.next_page_number&#125;&#125;/&quot;&gt;下一页&lt;/a&gt;</span><br><span class="line">&#123;%endif%&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://p3ek8hcdl.bkt.clouddn.com/image/page.gif" alt=""></p>
<h3 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h3><h4 id="使用Ajax"><a href="#使用Ajax" class="headerlink" title="使用Ajax"></a>使用Ajax</h4><ul>
<li>使用视图通过上下文向模板中传递数据，需要先加载完成模板的静态页面，再执行模型代码，生成最终的html，返回给浏览器，这个过程将页面与数据集成到了一起，扩展性差</li>
<li>改进方案：通过ajax的方式获取数据，通过dom操作将数据呈现到界面上</li>
<li>推荐使用框架的ajax相关方法，不要使用XMLHttpRequest对象，因为操作麻烦且不容易查错</li>
<li>jquery框架中提供了$.ajax、$.get、$.post方法，用于进行异步交互</li>
<li>由于csrf的约束，推荐使用$.get</li>
<li>示例：实现省市区的选择</li>
<li>最终实现效果如图：<br><img src="http://p3ek8hcdl.bkt.clouddn.com/image/city.gif" alt=""></li>
</ul>
<h5 id="引入js文件"><a href="#引入js文件" class="headerlink" title="引入js文件"></a>引入js文件</h5><ul>
<li>js文件属于静态文件，创建目录结构如图：<br><img src="http://p3ek8hcdl.bkt.clouddn.com/image/js.jpg" alt=""></li>
</ul>
<h5 id="修改settings-py关于静态文件的设置"><a href="#修改settings-py关于静态文件的设置" class="headerlink" title="修改settings.py关于静态文件的设置"></a>修改settings.py关于静态文件的设置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = &apos;/static/&apos;</span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, &apos;static&apos;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h5 id="在models-py中定义模型"><a href="#在models-py中定义模型" class="headerlink" title="在models.py中定义模型"></a>在models.py中定义模型</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class AreaInfo(models.Model):</span><br><span class="line">    atitle = models.CharField(max_length=20)</span><br><span class="line">    aparent = models.ForeignKey(&apos;self&apos;, null=True, blank=True)</span><br></pre></td></tr></table></figure>
<h5 id="生成迁移"><a href="#生成迁移" class="headerlink" title="生成迁移"></a>生成迁移</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>
<h5 id="向表中填充示例数据"><a href="#向表中填充示例数据" class="headerlink" title="向表中填充示例数据"></a>向表中填充示例数据</h5><ul>
<li><a href="http://p3ek8hcdl.bkt.clouddn.com/txt/area.txt" target="_blank" rel="noopener">测试数据</a></li>
<li>注意将表的名称完成替换</li>
</ul>
<h5 id="在views-py中编写视图"><a href="#在views-py中编写视图" class="headerlink" title="在views.py中编写视图"></a>在views.py中编写视图</h5><ul>
<li>index用于展示页面</li>
<li>getArea1用于返回省级数据</li>
<li>getArea2用于根据省、市编号返回市、区信息，格式都为字典对象<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line">from django.http import JsonResponse</span><br><span class="line">from models import AreaInfo</span><br><span class="line"></span><br><span class="line">def areaTest(request):</span><br><span class="line">    return render(request, &apos;booktest/areaTest.html&apos;)</span><br><span class="line"></span><br><span class="line">def getArea1(request):</span><br><span class="line">    list = AreaInfo.objects.filter(aparent__isnull=True)</span><br><span class="line">    list2 = []</span><br><span class="line">    for a in list:</span><br><span class="line">        list2.append([a.id,a.atitle])</span><br><span class="line">    return JsonResponse(&#123;&apos;data&apos;:list2&#125;)</span><br><span class="line"></span><br><span class="line">def getArea2(request, pid):</span><br><span class="line">    list = AreaInfo.objects.filter(aparent=pid)</span><br><span class="line">    list2 = []</span><br><span class="line">    for a in list:</span><br><span class="line">        list2.append([a.id,a.atitle])</span><br><span class="line">    return JsonResponse(&#123;&apos;data&apos;:list2&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="在urls-py中配置urlconf"><a href="#在urls-py中配置urlconf" class="headerlink" title="在urls.py中配置urlconf"></a>在urls.py中配置urlconf</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url(r&apos;^areaTest/$&apos;, views.areaTest),</span><br><span class="line">url(r&apos;^getArea/$&apos;, views.getArea1),</span><br><span class="line">url(r&apos;^(\d+)/$&apos;, views.getArea2),</span><br></pre></td></tr></table></figure>
<h5 id="定义模板areaTest-html"><a href="#定义模板areaTest-html" class="headerlink" title="定义模板areaTest.html"></a>定义模板areaTest.html</h5><ul>
<li><p>修改settings.py的TEMPLATES项，设置DIRS值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;DIRS&apos;: [os.path.join(BASE_DIR, &apos;templates&apos;)],</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义模板文件：包含三个select标签，分别存放省市区的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;省市区列表&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;select id=&quot;pro&quot;&gt;</span><br><span class="line">    &lt;option value=&quot;&quot;&gt;请选择省&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;select id=&quot;city&quot;&gt;</span><br><span class="line">    &lt;option value=&quot;&quot;&gt;请选择市&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;select id=&quot;dis&quot;&gt;</span><br><span class="line">    &lt;option value=&quot;&quot;&gt;请选择区县&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="在模板中引入jquery文件"><a href="#在模板中引入jquery文件" class="headerlink" title="在模板中引入jquery文件"></a>在模板中引入jquery文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;/static/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="编写js代码"><a href="#编写js代码" class="headerlink" title="编写js代码"></a>编写js代码</h5><ul>
<li>绑定change事件</li>
<li>发出异步请求</li>
<li>使用dom添加元素<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        $(function()&#123;</span><br><span class="line">            //页面加载完获取所有省</span><br><span class="line">            $.get(&apos;/getArea/&apos;,function (data) &#123;</span><br><span class="line">                var pro = $(&apos;#pro&apos;);</span><br><span class="line">                $.each(data.data,function (index,item) &#123;</span><br><span class="line">                    pro.append(&apos;&lt;option value=&quot;&apos;+ item[0] +&apos;&quot;&gt;&apos;+ item[1] +&apos;&lt;/option&gt;&apos;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            //省下拉列表改变时获取下面的市</span><br><span class="line">            $(&apos;#pro&apos;).change(function () &#123;</span><br><span class="line"></span><br><span class="line">                $.get(&apos;/&apos;+$(this).val()+&apos;/&apos;,function (data) &#123;</span><br><span class="line">                    //每次先清空再添加 防止一直追加</span><br><span class="line">                    var city = $(&apos;#city&apos;);</span><br><span class="line">                    city.empty().append(&apos;&lt;option value=&quot;&quot;&gt;请选择市&lt;/option&gt;&apos;);</span><br><span class="line">                    var dis=$(&apos;#dis&apos;);</span><br><span class="line">                    dis.empty().append(&apos;&lt;option value=&quot;&quot;&gt;请选择区县&lt;/option&gt;&apos;);</span><br><span class="line">                    $.each(data.data,function (index,item) &#123;</span><br><span class="line">                        city.append(&apos;&lt;option value=&quot;&apos;+ item[0] +&apos;&quot;&gt;&apos;+ item[1] +&apos;&lt;/option&gt;&apos;);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            //市下拉列表改变时获取下面的区县</span><br><span class="line">            $(&apos;#city&apos;).change(function () &#123;</span><br><span class="line">                $.get(&apos;/&apos;+$(this).val()+&apos;/&apos;,function (data) &#123;</span><br><span class="line">                    var dis = $(&apos;#dis&apos;);</span><br><span class="line">                    dis.empty().append(&apos;&lt;option value=&quot;&quot;&gt;请选择区县&lt;/option&gt;&apos;);</span><br><span class="line">                    $.each(data.data,function (index,item) &#123;</span><br><span class="line">                        dis.append(&apos;&lt;option value=&quot;&apos;+ item[0] +&apos;&quot;&gt;&apos;+ item[1] +&apos;&lt;/option&gt;&apos;);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="Mr.T 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.png" alt="Mr.T 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a>
          
            <a href="/tags/django/" rel="tag"><i class="fa fa-tag"></i> django</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/23/pythonmodel/" rel="next" title="Python模块发布和安装">
                <i class="fa fa-chevron-left"></i> Python模块发布和安装
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/02/04/Mysql/" rel="prev" title="Mysql">
                Mysql <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMzczNy8xMDI5MQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.png"
                alt="Mr.T" />
            
              <p class="site-author-name" itemprop="name">Mr.T</p>
              <p class="site-description motion-element" itemprop="description">web安全，渗透测试，PHP，Python，java。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#入门"><span class="nav-number">2.</span> <span class="nav-text">入门</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#环境搭建"><span class="nav-number">2.1.</span> <span class="nav-text">环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#python虚拟环境搭建"><span class="nav-number">2.1.1.</span> <span class="nav-text">python虚拟环境搭建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装django"><span class="nav-number">2.1.2.</span> <span class="nav-text">安装django</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建项目"><span class="nav-number">2.1.3.</span> <span class="nav-text">创建项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#目录说明"><span class="nav-number">2.1.4.</span> <span class="nav-text">目录说明</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设计模型"><span class="nav-number">2.2.</span> <span class="nav-text">设计模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数据库配置"><span class="nav-number">2.2.1.</span> <span class="nav-text">数据库配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建应用"><span class="nav-number">2.2.2.</span> <span class="nav-text">创建应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义模型类"><span class="nav-number">2.2.3.</span> <span class="nav-text">定义模型类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#生成数据表"><span class="nav-number">2.2.4.</span> <span class="nav-text">生成数据表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#测试数据操作"><span class="nav-number">2.2.5.</span> <span class="nav-text">测试数据操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关联对象的操作"><span class="nav-number">2.2.6.</span> <span class="nav-text">关联对象的操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#管理站点"><span class="nav-number">2.3.</span> <span class="nav-text">管理站点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#服务器"><span class="nav-number">2.3.1.</span> <span class="nav-text">服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#管理操作"><span class="nav-number">2.3.2.</span> <span class="nav-text">管理操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关联对象"><span class="nav-number">2.3.3.</span> <span class="nav-text">关联对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#布尔值的显示"><span class="nav-number">2.3.4.</span> <span class="nav-text">布尔值的显示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图"><span class="nav-number">2.4.</span> <span class="nav-text">视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URLconf"><span class="nav-number">2.5.</span> <span class="nav-text">URLconf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板"><span class="nav-number">2.6.</span> <span class="nav-text">模板</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#定义index-html模板"><span class="nav-number">2.6.1.</span> <span class="nav-text">定义index.html模板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义detail-html模板"><span class="nav-number">2.6.2.</span> <span class="nav-text">定义detail.html模板</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用模板"><span class="nav-number">2.7.</span> <span class="nav-text">使用模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#去除模板的硬编码"><span class="nav-number">2.8.</span> <span class="nav-text">去除模板的硬编码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Render简写"><span class="nav-number">2.9.</span> <span class="nav-text">Render简写</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模型"><span class="nav-number">3.</span> <span class="nav-text">模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ORM简介"><span class="nav-number">3.1.</span> <span class="nav-text">ORM简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用MySql数据库"><span class="nav-number">3.2.</span> <span class="nav-text">使用MySql数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开发流程"><span class="nav-number">3.3.</span> <span class="nav-text">开发流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用数据库生成模型类"><span class="nav-number">3.4.</span> <span class="nav-text">使用数据库生成模型类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义模型"><span class="nav-number">3.5.</span> <span class="nav-text">定义模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#定义模型-1"><span class="nav-number">3.5.1.</span> <span class="nav-text">定义模型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义属性"><span class="nav-number">3.5.2.</span> <span class="nav-text">定义属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字段类型"><span class="nav-number">3.5.3.</span> <span class="nav-text">字段类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字段选项"><span class="nav-number">3.5.4.</span> <span class="nav-text">字段选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关系"><span class="nav-number">3.5.5.</span> <span class="nav-text">关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#元选项"><span class="nav-number">3.5.6.</span> <span class="nav-text">元选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例演示"><span class="nav-number">3.5.7.</span> <span class="nav-text">示例演示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#测试数据"><span class="nav-number">3.5.8.</span> <span class="nav-text">测试数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模型成员"><span class="nav-number">3.6.</span> <span class="nav-text">模型成员</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#类的属性"><span class="nav-number">3.6.1.</span> <span class="nav-text">类的属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#管理器Manager"><span class="nav-number">3.6.2.</span> <span class="nav-text">管理器Manager</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建对象"><span class="nav-number">3.6.3.</span> <span class="nav-text">创建对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实例的属性"><span class="nav-number">3.6.4.</span> <span class="nav-text">实例的属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实例的方法"><span class="nav-number">3.6.5.</span> <span class="nav-text">实例的方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模型查询"><span class="nav-number">3.7.</span> <span class="nav-text">模型查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简介-1"><span class="nav-number">3.7.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询集"><span class="nav-number">3.7.2.</span> <span class="nav-text">查询集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#限制查询集"><span class="nav-number">3.7.3.</span> <span class="nav-text">限制查询集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询集的缓存"><span class="nav-number">3.7.4.</span> <span class="nav-text">查询集的缓存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字段查询"><span class="nav-number">3.7.5.</span> <span class="nav-text">字段查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#比较运算符"><span class="nav-number">3.7.6.</span> <span class="nav-text">比较运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#聚合函数"><span class="nav-number">3.7.7.</span> <span class="nav-text">聚合函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#F对象"><span class="nav-number">3.7.8.</span> <span class="nav-text">F对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Q对象"><span class="nav-number">3.7.9.</span> <span class="nav-text">Q对象</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自连接"><span class="nav-number">3.8.</span> <span class="nav-text">自连接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视图-1"><span class="nav-number">4.</span> <span class="nav-text">视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#URLconf-1"><span class="nav-number">4.1.</span> <span class="nav-text">URLconf</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#包含其它的URLconfs"><span class="nav-number">4.1.1.</span> <span class="nav-text">包含其它的URLconfs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#URL的反向解析"><span class="nav-number">4.1.2.</span> <span class="nav-text">URL的反向解析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图函数"><span class="nav-number">4.2.</span> <span class="nav-text">视图函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#定义视图"><span class="nav-number">4.2.1.</span> <span class="nav-text">定义视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#404-page-not-found-视图"><span class="nav-number">4.2.2.</span> <span class="nav-text">404 (page not found) 视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#500-server-error-视图"><span class="nav-number">4.2.3.</span> <span class="nav-text">500 (server error) 视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#400-bad-request-视图"><span class="nav-number">4.2.4.</span> <span class="nav-text">400 (bad request) 视图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reqeust对象"><span class="nav-number">4.3.</span> <span class="nav-text">Reqeust对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HttpReqeust对象"><span class="nav-number">4.3.1.</span> <span class="nav-text">HttpReqeust对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#属性"><span class="nav-number">4.3.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法"><span class="nav-number">4.3.3.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#QueryDict对象"><span class="nav-number">4.3.4.</span> <span class="nav-text">QueryDict对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GET属性"><span class="nav-number">4.3.5.</span> <span class="nav-text">GET属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POST属性"><span class="nav-number">4.3.6.</span> <span class="nav-text">POST属性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Response对象"><span class="nav-number">4.4.</span> <span class="nav-text">Response对象</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HttpResponse对象"><span class="nav-number">4.4.1.</span> <span class="nav-text">HttpResponse对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方法-1"><span class="nav-number">4.4.2.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#子类HttpResponseRedirect"><span class="nav-number">4.4.3.</span> <span class="nav-text">子类HttpResponseRedirect</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#子类JsonResponse"><span class="nav-number">4.4.4.</span> <span class="nav-text">子类JsonResponse</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#简写函数"><span class="nav-number">4.4.5.</span> <span class="nav-text">简写函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#render"><span class="nav-number">4.4.5.1.</span> <span class="nav-text">render</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#重定向"><span class="nav-number">4.4.5.2.</span> <span class="nav-text">重定向</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态保持"><span class="nav-number">4.5.</span> <span class="nav-text">状态保持</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#启用session"><span class="nav-number">4.5.1.</span> <span class="nav-text">启用session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用session"><span class="nav-number">4.5.2.</span> <span class="nav-text">使用session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用户登录示例"><span class="nav-number">4.5.3.</span> <span class="nav-text">用户登录示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#会话过期时间"><span class="nav-number">4.5.4.</span> <span class="nav-text">会话过期时间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#存储session"><span class="nav-number">4.5.5.</span> <span class="nav-text">存储session</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用Redis缓存session"><span class="nav-number">4.5.6.</span> <span class="nav-text">使用Redis缓存session</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模板-1"><span class="nav-number">5.</span> <span class="nav-text">模板</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#模板介绍"><span class="nav-number">5.1.</span> <span class="nav-text">模板介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模板处理"><span class="nav-number">5.1.1.</span> <span class="nav-text">模板处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#快捷函数"><span class="nav-number">5.1.2.</span> <span class="nav-text">快捷函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义模板"><span class="nav-number">5.2.</span> <span class="nav-text">定义模板</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#变量"><span class="nav-number">5.2.1.</span> <span class="nav-text">变量</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#在模板中调用对象的方法"><span class="nav-number">5.2.1.1.</span> <span class="nav-text">在模板中调用对象的方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#标签"><span class="nav-number">5.2.2.</span> <span class="nav-text">标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#过滤器"><span class="nav-number">5.2.3.</span> <span class="nav-text">过滤器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注释"><span class="nav-number">5.2.4.</span> <span class="nav-text">注释</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反向解析"><span class="nav-number">5.3.</span> <span class="nav-text">反向解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板继承"><span class="nav-number">5.4.</span> <span class="nav-text">模板继承</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#说明"><span class="nav-number">5.4.1.</span> <span class="nav-text">说明</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTML转义"><span class="nav-number">5.5.</span> <span class="nav-text">HTML转义</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#会被自动转义的字符"><span class="nav-number">5.5.1.</span> <span class="nav-text">会被自动转义的字符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关闭转义"><span class="nav-number">5.5.2.</span> <span class="nav-text">关闭转义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#手动转义"><span class="nav-number">5.5.3.</span> <span class="nav-text">手动转义</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#csrf"><span class="nav-number">5.6.</span> <span class="nav-text">csrf</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#防csrf的使用"><span class="nav-number">5.6.1.</span> <span class="nav-text">防csrf的使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#取消保护"><span class="nav-number">5.6.2.</span> <span class="nav-text">取消保护</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#保护原理"><span class="nav-number">5.6.3.</span> <span class="nav-text">保护原理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证码"><span class="nav-number">5.7.</span> <span class="nav-text">验证码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#验证码视图"><span class="nav-number">5.7.1.</span> <span class="nav-text">验证码视图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置url"><span class="nav-number">5.7.2.</span> <span class="nav-text">配置url</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#显示验证码"><span class="nav-number">5.7.3.</span> <span class="nav-text">显示验证码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#验证"><span class="nav-number">5.7.4.</span> <span class="nav-text">验证</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级"><span class="nav-number">6.</span> <span class="nav-text">高级</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#静态文件处理"><span class="nav-number">6.1.</span> <span class="nav-text">静态文件处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置静态文件"><span class="nav-number">6.1.1.</span> <span class="nav-text">配置静态文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中间件"><span class="nav-number">6.2.</span> <span class="nav-text">中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#上传图片"><span class="nav-number">6.3.</span> <span class="nav-text">上传图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Admin站点"><span class="nav-number">6.4.</span> <span class="nav-text">Admin站点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ModelAdmin对象"><span class="nav-number">6.4.1.</span> <span class="nav-text">ModelAdmin对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#列表页选项"><span class="nav-number">6.4.2.</span> <span class="nav-text">列表页选项</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#“操作选项”的位置"><span class="nav-number">6.4.2.1.</span> <span class="nav-text">“操作选项”的位置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#list-display"><span class="nav-number">6.4.2.2.</span> <span class="nav-text">list_display</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#list-filter"><span class="nav-number">6.4.2.3.</span> <span class="nav-text">list_filter</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#list-per-page"><span class="nav-number">6.4.2.4.</span> <span class="nav-text">list_per_page</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-fields"><span class="nav-number">6.4.2.5.</span> <span class="nav-text">search_fields</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#增加与修改页选项"><span class="nav-number">6.4.3.</span> <span class="nav-text">增加与修改页选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#InlineModelAdmin对象"><span class="nav-number">6.4.4.</span> <span class="nav-text">InlineModelAdmin对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重写admin模板"><span class="nav-number">6.4.5.</span> <span class="nav-text">重写admin模板</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分页"><span class="nav-number">6.5.</span> <span class="nav-text">分页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Paginator对象"><span class="nav-number">6.5.1.</span> <span class="nav-text">Paginator对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#属性-1"><span class="nav-number">6.5.1.1.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方法-2"><span class="nav-number">6.5.1.2.</span> <span class="nav-text">方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#异常exception"><span class="nav-number">6.5.1.3.</span> <span class="nav-text">异常exception</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Page对象"><span class="nav-number">6.5.2.</span> <span class="nav-text">Page对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建对象-1"><span class="nav-number">6.5.2.1.</span> <span class="nav-text">创建对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#属性-2"><span class="nav-number">6.5.2.2.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方法-3"><span class="nav-number">6.5.2.3.</span> <span class="nav-text">方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#示例"><span class="nav-number">6.5.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ajax"><span class="nav-number">6.6.</span> <span class="nav-text">ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用Ajax"><span class="nav-number">6.6.1.</span> <span class="nav-text">使用Ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#引入js文件"><span class="nav-number">6.6.1.1.</span> <span class="nav-text">引入js文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#修改settings-py关于静态文件的设置"><span class="nav-number">6.6.1.2.</span> <span class="nav-text">修改settings.py关于静态文件的设置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在models-py中定义模型"><span class="nav-number">6.6.1.3.</span> <span class="nav-text">在models.py中定义模型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#生成迁移"><span class="nav-number">6.6.1.4.</span> <span class="nav-text">生成迁移</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#向表中填充示例数据"><span class="nav-number">6.6.1.5.</span> <span class="nav-text">向表中填充示例数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在views-py中编写视图"><span class="nav-number">6.6.1.6.</span> <span class="nav-text">在views.py中编写视图</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在urls-py中配置urlconf"><span class="nav-number">6.6.1.7.</span> <span class="nav-text">在urls.py中配置urlconf</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#定义模板areaTest-html"><span class="nav-number">6.6.1.8.</span> <span class="nav-text">定义模板areaTest.html</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在模板中引入jquery文件"><span class="nav-number">6.6.1.9.</span> <span class="nav-text">在模板中引入jquery文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#编写js代码"><span class="nav-number">6.6.1.10.</span> <span class="nav-text">编写js代码</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.T</span>

  
</div>
<div class="busuanzi-count">
  <script async="" src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv">1081</span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv">2439</span>
      
    </span>
  
</div>


<!-- 
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>
-->



<!-- 
  <span class="post-meta-divider">|</span>
  -->



<!--
  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>
 -->




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

</body>
</html>
